<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Advanced Methods for Multivariate Analysis</title>
    <meta charset="utf-8" />
    <meta name="author" content="Jonathan Jupke" />
    <script src="assets/header-attrs/header-attrs.js"></script>
    <link href="assets/tile-view/tile-view.css" rel="stylesheet" />
    <script src="assets/tile-view/tile-view.js"></script>
    <link href="assets/animate.css/animate.xaringan.css" rel="stylesheet" />
    <link href="assets/tachyons/tachyons.min.css" rel="stylesheet" />
    <link href="assets/panelset/panelset.css" rel="stylesheet" />
    <script src="assets/panelset/panelset.js"></script>
    <script type="application/json" id="xaringanExtra-editable-docid">{"id":"x57ce3073a66417fb2be67d2a078f3d8","expires":14}</script>
    <script src="assets/himalaya/himalaya.js"></script>
    <script src="assets/js-cookie/js.cookie.js"></script>
    <link href="assets/editable/editable.css" rel="stylesheet" />
    <script src="assets/editable/editable.js"></script>
    <script src="assets/clipboard/clipboard.min.js"></script>
    <link href="assets/shareon/shareon.min.css" rel="stylesheet" />
    <script src="assets/shareon/shareon.min.js"></script>
    <link href="assets/xaringanExtra-shareagain/shareagain.css" rel="stylesheet" />
    <script src="assets/xaringanExtra-shareagain/shareagain.js"></script>
    <link href="assets/xaringanExtra-extra-styles/xaringanExtra-extra-styles.css" rel="stylesheet" />
    <script src="assets/fabric/fabric.min.js"></script>
    <link href="assets/xaringanExtra-scribble/scribble.css" rel="stylesheet" />
    <script src="assets/xaringanExtra-scribble/scribble.js"></script>
    <script>document.addEventListener('DOMContentLoaded', function() { window.xeScribble = new Scribble({"pen_color":["#FF0000"],"pen_size":3,"eraser_size":30,"palette":[]}) })</script>
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
    <link rel="stylesheet" href="xaringan-extra.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">


class: title-slide middle

# Advanced Methods for Multivariate Analysis

## MOD3: Advanced data science

.author[
Jonathan Jupke
]







---

layout: false
class: full-screen hide-count

&lt;div class="grid-2-2"&gt;
&lt;div class="extension-tile tileview"&gt;&lt;div&gt;Multi-what?&lt;/div&gt;&lt;/div&gt;
--
&lt;div class="extension-tile panelset-tile"&gt;&lt;div&gt;What's new?&lt;/div&gt;&lt;/div&gt;
--
&lt;div class="extension-tile webcam"&gt;&lt;div&gt;Multivariate GLMs&lt;/div&gt;&lt;/div&gt;
--
&lt;div class="extension-tile editable"&gt;&lt;div&gt;Latent Variable Models&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;


---

layout: false
class: full-screen hide-count

&lt;div class="grid-2-2"&gt;
&lt;div class="extension-tile tileview animated fadeInRight"&gt;&lt;div&gt;Multi-what?&lt;/div&gt;&lt;/div&gt;
&lt;/div&gt;

---

## *multivariate* ... what was that again?

.can-edit.f3.code[
- PCA
- ...
]

---

## *multivariate* = multiresponse

.center[
&lt;p style="font-size:300%;"&gt; multi&lt;b&gt;.green[response]&lt;/b&gt; &lt;u&gt;not&lt;/u&gt; multi&lt;b&gt;.red[variable]&lt;/b&gt;&lt;/p&gt; 
]

--

.w-50.pr3.fl[
&lt;table&gt;
  &lt;tr&gt;
    &lt;th&gt;&lt;/th&gt;
    &lt;th&gt;&lt;font color="green"&gt;Species1&lt;/font&gt; &amp;#128000;&lt;/th&gt;
    &lt;th&gt;&lt;font color="green"&gt;Species2&lt;/font&gt; &amp;#128007;&lt;/th&gt;
    &lt;th&gt;&lt;font color="green"&gt;Species3&lt;/font&gt; &amp;#128008;&lt;/th&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;Site1&lt;/td&gt;
    &lt;td&gt;17&lt;/td&gt;
    &lt;td&gt;10&lt;/td&gt;
    &lt;td&gt;3&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;Site2&lt;/td&gt;
    &lt;td&gt;20&lt;/td&gt;
    &lt;td&gt;8&lt;/td&gt;
    &lt;td&gt;2&lt;/td&gt;
  &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td&gt;Site3&lt;/td&gt;
    &lt;td&gt;8&lt;/td&gt;
    &lt;td&gt;16&lt;/td&gt;
    &lt;td&gt;5&lt;/td&gt;
  &lt;/tr&gt;
&lt;/table&gt;
]
.w-50.pr3.fl[
&lt;table&gt;
  &lt;tr&gt;
    &lt;th&gt;&lt;/th&gt;
    &lt;th&gt;&lt;font color="red"&gt;Predictor1&lt;/font&gt; &amp;#127774;&lt;/th&gt;
    &lt;th&gt;&lt;font color="red"&gt;Predictor2&lt;/font&gt; &amp;#127974;&lt;/th&gt;
    &lt;th&gt;&lt;font color="red"&gt;Predictor3&lt;/font&gt; &amp;#128293;&lt;/th&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;Site1&lt;/td&gt;
    &lt;td&gt;33&lt;/td&gt;
    &lt;td&gt;0&lt;/td&gt;
    &lt;td&gt;20&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;Site2&lt;/td&gt;
    &lt;td&gt;20&lt;/td&gt;
    &lt;td&gt;20&lt;/td&gt;
    &lt;td&gt;3&lt;/td&gt;
  &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td&gt;Site3&lt;/td&gt;
    &lt;td&gt;15&lt;/td&gt;
    &lt;td&gt;50&lt;/td&gt;
    &lt;td&gt;0&lt;/td&gt;
  &lt;/tr&gt;
&lt;/table&gt;
]

---

## Why multivariate analyses? 

&lt;p style="font-size:200%";&gt;
üåé ecological data are multivariate 
&lt;/p&gt;

--

&lt;p style="font-size:200%";&gt;
üêã multiple species from communities with emergent properties 
&lt;/p&gt;

--

&lt;p style="font-size:200%";&gt;
ü¶ö co-occurrence patterns 
&lt;/p&gt;

--

&lt;p style="font-size:200%";&gt;
üí™ borrow strength 
&lt;/p&gt;

---

##Applied Multivariate statistics 

.w-50.pr3.fl[

- &lt;p style="font-size:200%;"&gt;Multiple Regression&lt;/p&gt;
- &lt;p style="font-size:200%;"&gt;Generalized Linear Models&lt;/p&gt;
- &lt;p style="font-size:200%;"&gt;Ordination and PCA  &lt;/p&gt;
- &lt;p style="font-size:200%;"&gt;Redundancy Analysis (RDA)&lt;/p&gt;    
]

--

.w-50.pr3.fl[
- &lt;p style="font-size:200%;"&gt;Similarity and distance - NMDS  &lt;/p&gt; 
- &lt;p style="font-size:200%;"&gt;MANOVA and PERMANOVA   &lt;/p&gt; 
- &lt;p style="font-size:200%;"&gt;Cluster analysis  &lt;/p&gt; 
- &lt;p style="font-size:200%;"&gt;Decision Tree&lt;/p&gt; 
]

---

## Ordination

.footnote[Whitaker 1967]

&lt;p style="font-size:200%";&gt;
- term proposed by Goodall (1954)
&lt;/p&gt;

&lt;p style="font-size:200%";&gt;
- plant sociology should be based on gradients not classes (taxonometrics)
&lt;/p&gt;

.center[
        &lt;img src="images/gradient.png" width="800"&gt;
]
  
---

## Principal Component Analysis
        
.w-50.pr3.fl[

```r
library(vegan)
data(varechem)
res &lt;- rda(varechem, 
           scale = TRUE)
plot(res)
```
]
--
![](index_files/figure-html/unnamed-chunk-3-1.png)&lt;!-- --&gt;

---

## Principal Component Analysis
        

```r
res$CA$v[1:4,1:4]
```

```
##            PC1         PC2         PC3         PC4
## N   0.09462709  0.12435859 -0.16204826  0.79318367
## P  -0.35589258 -0.20731069  0.09086948  0.08242977
## K  -0.36318854 -0.16172669 -0.04259682  0.21401371
## Ca -0.35975485 -0.08457237  0.32644437 -0.01826328
```

---

## Principal Component Analysis

.center[
&lt;p style="font-size:250%;"&gt; 
ü¶ê or üåä :  unconstrained
&lt;/p&gt;    
]    

--
.center[
&lt;p style="font-size:250%;"&gt;
ü¶ê and üåä :  &lt;s&gt;un&lt;/s&gt;constrained
&lt;/p&gt;        
]
---

## Redundancy Analysis
.center[        
&lt;p style="font-size:200%;"&gt;
1.  .blue[Multiple Regression]: Y&amp;#770; = &amp;#946;&lt;b&gt;X&lt;/b&gt; &lt;/p&gt;
]
--
.center[  
&lt;p style="font-size:200%;"&gt;
2.  .blue[PCA]: PCA(Y&amp;#770;) = PCA(&amp;#946;&lt;b&gt;X&lt;/b&gt;)&lt;/p&gt;   
]
---

## Redundancy Analysis

.w-50.pr3.fl[

```r
library(vegan)
data(varespec)
res &lt;- rda(varespec ~ ., 
           data = varechem, 
           scale = TRUE)
plot(res)
```
]

--

![](index_files/figure-html/unnamed-chunk-6-1.png)&lt;!-- --&gt;

---

## Distance and Dissimularity
        
&lt;!--&lt;font size="32"&gt; Distance metrics reduce dimensionality&lt;/font&gt; --&gt; 
.center[
        ![](images/How-to-create-a-distance-matrix.png)
]

---

## NMDS
&lt;font size="32"&gt; Points in k dimensional space have similar distance ranks &lt;/font&gt;
--
.w-50.pr3.fl[

```r
vare.nmds &lt;- metaMDS(comm = varespec)
```
]

--

![](index_files/figure-html/unnamed-chunk-8-1.png)&lt;!-- --&gt;

```
## integer(0)
```

---
layout: false
class: full-screen hide-count

&lt;div class="grid-2-2"&gt;
        &lt;div class="extension-tile tileview"&gt;&lt;div&gt;Multi-what? &amp;#10004;&lt;/div&gt;&lt;/div&gt;
--
        &lt;div class="extension-tile panelset-tile animated fadeInRight"&gt;&lt;div&gt;Whats new?&lt;/div&gt;&lt;/div&gt;
        &lt;/div&gt;
        
---

## Are there problems? 

&lt;p style="font-size:150%;"&gt; üß≤ Horseshoe effect &lt;/p&gt; 
--
&lt;p style="font-size:150%;"&gt; ‚úîÔ∏è difficult to check assumptions &lt;/p&gt;  
--
&lt;p style="font-size:150%;"&gt; üìà mean variance relationship &lt;/p&gt;  

--

&lt;p style="font-size:150%;"&gt;  Solutions?  &lt;/p&gt; 

--

&lt;p style="font-size:150%;"&gt; ‚û°Ô∏è Apply Regression concepts to multivariate data &lt;/p&gt;  
&lt;p style="font-size:150%;"&gt;Ô∏è‚û°Ô∏è Ô∏èResidual diagnostics, model selection,  flexible mean-variance relationship&lt;/p&gt;

---


### Why didn't we do that from the start?  

--

.center[
![](images/old_pc.gif)
]

---

## What are model-based approaches? 
  
&lt;p style="font-size:150%;"&gt; &amp;#128218 model-based approaches assume a .green[parametric generative model] &lt;/p&gt;

--

&lt;p style="font-size:150%;"&gt; &amp;#127993 .green[model-based] vs. .orange[distance-based] &lt;/p&gt;

--

&lt;p style="font-size:150%;"&gt; &amp;#9889 terms are not consistent &lt;/p&gt;

--

&lt;p style="font-size:150%;"&gt; &amp;#128172 alternative name: .orange[algorithm-based] (Warton &lt;l&gt;et al.&lt;/l&gt; 2015) &lt;/p&gt;

--

&lt;p style="font-size:150%;"&gt; &amp;#128584 in many ways, .orange[distance-based methods] are also models &lt;/p&gt;

---
## What are model-based approaches?

&lt;blockquote&gt;
Our constrained ordination model [...] 
.right[-- &lt;cite&gt;Brittain *et al.* (2020)&lt;/cite&gt;]
&lt;/blockquote&gt;

--
        
&lt;blockquote&gt;
Many biologist fit CCA models [...] 
.right[-- &lt;cite&gt;Yee (2004) &lt;/cite&gt;]
&lt;/blockquote&gt;

---
        
## mean-variance relationship
        
&lt;p style="font-size:200%;"&gt; Ordinary Linear Regression &lt;/p&gt; 

--

&lt;p style="font-size:150%;"&gt; y&lt;sub&gt;i&lt;/sub&gt; = &amp;alpha; + &amp;beta; x&lt;sub&gt;i&lt;/sub&gt; + &amp;epsilon;&lt;sub&gt;i&lt;/sub&gt; &lt;/p&gt;

--


&lt;p style="font-size:150%;"&gt; y&lt;sub&gt;i&lt;/sub&gt; &amp;sim; N(&amp;alpha; + &amp;beta; x&lt;sub&gt;i&lt;/sub&gt;, &amp;sigma;&lt;sup&gt;2&lt;/sup&gt;)&lt;/p&gt; 

--

&lt;p style="font-size:150%;"&gt; &amp;epsilon;&lt;sub&gt;i&lt;/sub&gt; &amp;sim; N(&amp;mu; = 0, &amp;sigma;&lt;sup&gt;2&lt;/sup&gt;)&lt;/p&gt; 

--

&lt;p style = "font-size:200%;"&gt;The variance does not change with the mean! &lt;/p&gt;

---

## mean-variance relationship

&lt;p style="font-size:200%;"&gt; Poisson GLM &lt;/p&gt;

--

&lt;p style="font-size:150%;"&gt; 
L&lt;sub&gt;i&lt;/sub&gt; = &amp;alpha; + &amp;beta; x&lt;sub&gt;i&lt;/sub&gt; + &amp;epsilon;&lt;sub&gt;i&lt;/sub&gt;
&lt;/p&gt;

--

&lt;p style="font-size:150%;"&gt;
y&lt;sub&gt;i&lt;/sub&gt; &amp;sim; Poisson(&amp;lambda; = exp(L&lt;sub&gt;i&lt;/sub&gt;))
&lt;/p&gt;

--

&lt;p style="font-size:200%;"&gt; 
&amp;lambda; = &amp;mu; = &amp;sigma; 
&lt;/p&gt;
        
--
        
&lt;p style="font-size:200%;"&gt;  
The variance and the mean are the same 
&lt;/p&gt;

---

.center[
        &lt;img src="images/glm_error.PNG" width="620"&gt;
]

---

.center[
        &lt;img src="images/WWW12_4.png" width="620"&gt;
]

.footnote[Warton *et al.* (2012)]

---


&lt;img src="index_files/figure-html/example-binomial-mean-var-1.png" style="display: block; margin: auto;" /&gt;

---
        
## mean-variance relationship
        
&lt;p style="font-size:200%;"&gt;
.orange[distance metrics] assume a mean-variance relationship &lt;br&gt;
&lt;/p&gt;

--

&lt;p style="font-size:150%;"&gt; Euclidean Distance &lt;/p&gt;

`$$\huge d_{ij} = \sqrt{\sum_{s=1}^S (y_{is} - y_{js})^2}$$`
        
--

&lt;p style="font-size:150%;"&gt;        
The difference is not weight by the absolute values 
&lt;/p&gt;

--

&lt;p style="font-size:150%;"&gt;       
Assumes a constant variance.
&lt;/p&gt;

---

## mean-variance relationship  

&lt;p style="font-size:150%;"&gt;       
Canberra distance 
&lt;/p&gt;

--

`$$\huge d_{ij} = \sum_{s=1}^S \frac{|y_{is} - y_{js}|}{(y_{is} - y_{js})}$$`

--

&lt;p style="font-size:150%;"&gt;        
Straight line relationship
&lt;/p&gt;

---

## Are models better? 

.center[
        &lt;img src="images/WWW12_1_1.png" width="900"&gt;
]

.footnote[Warton *et al.* (2012)]

---
 
## Are models better? 
        
.center[
        &lt;img src="images/WWW12_1_2.png" width="900"&gt;
]
        

        
.footnote[Warton *et al.* (2012)]

---

## Are models better?
        
.center[
        &lt;img src="images/WWW12_1.png" width="900"&gt;
]

.footnote[Warton *et al.* (2012)]

---
 
## Are models better? 

.center[
        &lt;img src="images/jupke20_1.png" width="850"&gt;
]
        
.footnote[Jupke &amp; Sch√§fer (2020)]


---

## Conclusion: What's new 
        
- &lt;p style="font-size:200%;"&gt;
classical approaches use distances as heuristic
&lt;/p&gt;

--

- &lt;p style="font-size:200%;"&gt;
 advances in statistics and computer power enable us to use multivariate models
&lt;/p&gt;

--
   
- &lt;p style="font-size:200%;"&gt;        
 some models perform better in comparisons but it depends on data, question, and specific methods
&lt;/p&gt;

---

layout: false
class: full-screen hide-count

&lt;div class="grid-2-2"&gt;

&lt;div class="extension-tile tileview"&gt;&lt;div&gt;Multi-what? &amp;#10004&lt;/div&gt;&lt;/div&gt;
&lt;div class="extension-tile panelset-tile"&gt;&lt;div&gt;What's new? &amp;#10004&lt;/div&gt;&lt;/div&gt;
--
&lt;div class="extension-tile webcam animated fadeInRight"&gt;&lt;div&gt;Multivariate GLMs&lt;/div&gt;&lt;/div&gt;

&lt;/div&gt;

---

## mvabund 
.footnote[Wang *et al.* (2012)]

&lt;p style="font-size:200%;"&gt;   
R package published in 2012  &lt;br&gt;

&lt;b&gt;M&lt;/b&gt;ulti&lt;b&gt;v&lt;/b&gt;ariate &lt;b&gt;Abund&lt;/b&gt;ance data  
&lt;/p&gt;

--
   
&lt;p style="font-size:150%;"&gt; &amp;#9776; many, possibly correlated responses &lt;/p&gt; 

&lt;p style="font-size:150%;"&gt; üìà strong mean-variance relationship  &lt;/p&gt;

---

.footnote[Pollock *et al.* (2014)]

## The joint model 

`$$\huge \hat{y}_{is} = \beta_{0s} + \beta_s x_i + u_{ij}$$`
`$$\huge u_i \sim N(0, \Sigma)$$`


---

### What is problematic with this approach?

--


&lt;img src="index_files/figure-html/unnamed-chunk-9-1.png" style="display: block; margin: auto;" /&gt;

---
        
## Simplify

&lt;p style="font-size:150%;"&gt; 
üí≠ Instead of estimating &amp;Sigma; we can .blue[assume] it.
&lt;/p&gt;
--
&lt;p style="font-size:150%;"&gt;
‚öôÔ∏è That's how .blue[mvabund] works 
&lt;/p&gt;
--
&lt;p style="font-size:150%;"&gt;
ü§∑ Ok, if primary interest is species-environment relationships  
&lt;/p&gt;

--
&lt;p style="font-size:150%;"&gt;
üîÇ  Fit a separate GLM to each species
&lt;/p&gt;
--
&lt;p style="font-size:150%;"&gt;  
üôã How is that multivariate? 
&lt;/p&gt;
--
&lt;p style="font-size:150%;"&gt;
‚è≠Ô∏è ... only at the inference stage
&lt;/p&gt;

---
        
## test statistics  
        
.w-50.pr3.fl[
&lt;p style="font-size:150%;"&gt;      
.blue[Likelihood Ratio] 
&lt;/p&gt;

`\(\huge LR = 2\ \bigg[log (L_{MLE}) - log(L_{H_0})\bigg]\)`
]
--
.w-50.pr3.fl[
&lt;p style="font-size:150%;"&gt;       
.blue[Sum of Likelihood Ratios]  
&lt;/p&gt;

`\(\huge \Sigma LR = \Sigma_s^SLR_s\)`
]

--
.w-100.pr3.fl[     
&lt;p style="font-size:150%;"&gt; 
- &amp;Sigma;LR does not account for inter-species correlations   &lt;br&gt; 
- but the permutation-based &lt;i&gt;p&lt;/i&gt; -value does  
&lt;/p&gt;
]

---

## Correlation options
        
.footnote[Warton (2008a, 2011)]

&lt;p style="font-size:180%;"&gt;
  .blue[&lt;b&gt;"I"&lt;/b&gt;] &lt;br&gt;
  No correlation, default setting 
&lt;/p&gt;

--
     
&lt;p style="font-size:180%;"&gt;        
  .blue[&lt;b&gt; "R" &lt;/b&gt;]  &lt;br&gt; 
  &lt;i&gt; true &lt;/i&gt; joint model 
&lt;/p&gt;

--

&lt;p style="font-size:180%;"&gt;    
  .blue[&lt;b&gt;"shrink"&lt;/b&gt;] &lt;br&gt;  
  middle option, shrinks &amp;Sigma; to &lt;b&gt;I&lt;/b&gt; with ridge regularization 
&lt;/p&gt;

---

## MvAbund Example 
        
        

```r
library(mvabund)
head(copepods[,1:3])
```

--
        

```
##      Ameira Adopsyllus Ectinosoma
## B1D1     43          0          0
## B1D2     63          0          0
## B1U1    124          0          0
## B1U2    105          0          2
## B2D1      4          0          0
## B2D2      5          0          0
```

--
        

```r
tasmvabund &lt;- mvabund(copepods)
```

--
        

---

## mean-variance plot


```r
meanvar.plot(tasmvabund)
```

.center[
        &lt;img src="images/R_mvabund_mean-var_plot.png" width="420", height="420"&gt;
]

---
        
## Fitting a model


```r
tas.nb &lt;- manyglm(copepods ~ block*treatment,
                  data = x,
                  family = "negative.binomial")
```


---
        
## Checking model assumptions 

.center[        
![](index_files/figure-html/mvabund Checking model assumptions 1-1.png)&lt;!-- --&gt;
]

.footnote[Dunn &amp; Smyth (1996)]

---
        
## Checking model assumptions

.center[
![](index_files/figure-html/mvabund Checking model assumptions 2-1.png)&lt;!-- --&gt;
]

.footnote[Dunn &amp; Smyth (1996)]

---
        
## Checking model assumptions

.center[
![](index_files/figure-html/mvabund Checking model assumptions 3-1.png)&lt;!-- --&gt;
]

.footnote[Dunn &amp; Smyth (1996)]

---
        
## Testing Hypotheses
        



```r
anova_out &lt;- anova(tas.nb, p.uni = "adjusted")
```

.scroll-output[
        

```
## Analysis of Deviance Table
## 
## Model: cop_mvabund ~ block * treatment
## 
## Multivariate test:
##                 Res.Df Df.diff    Dev Pr(&gt;Dev)    
## (Intercept)         15                            
## block               12       3 117.48    0.001 ***
## treatment           11       1  66.91    0.001 ***
## block:treatment      8       3  37.41    0.077 .  
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## Arguments:
##  Test statistics calculated assuming uncorrelated response (for faster computation) 
##  P-value calculated using 999 iterations via PIT-trap resampling.
```
        
]

---


```r
mvabund::coefplot(tas.nb, which.Xcoef = 3)
```

&lt;img src="index_files/figure-html/unnamed-chunk-11-1.png" style="display: block; margin: auto;" /&gt;

---
        
## Beta plot 
        



.center[
        &lt;img src="images/beta.png" width="800"&gt;
]


---

## Traits 
&lt;p style="font-size:200%;"&gt;
Not discussed in today. &lt;br&gt; 
See &lt;a href="https://rpubs.com/dwarton/68823"&gt;here&lt;/a&gt; for introduction:
Or the mvabund post on the &lt;a href="https://jonjup.netlify.app/post/2020-12-08-analyzing-the-anttraits-data-with-mvabund/analyzing-the-anttraits-data-with-mvabund/"&gt;blog&lt;/a&gt;
&lt;/p&gt;

---
        
## Conclusion: mvabund
 
&lt;p style="font-size:200%;"&gt; 
- Recurring problem is estimating &amp;Sigma; - .blue[&lt;b&gt;too many parameters&lt;/b&gt;]
&lt;/p&gt;

--

&lt;p style="font-size:200%;"&gt;         
- in .blue[&lt;b&gt;mvabund&lt;/b&gt;] only the inference is multivariate, models are fit separately
&lt;/p&gt;

--

&lt;p style="font-size:200%;"&gt; 
- .blue[&lt;b&gt;inference&lt;/b&gt;] through row-permutation and aggregated test statistics. 
&lt;/p&gt;

--

&lt;p style="font-size:200%;"&gt; 
- no dimension reduction ‚û°Ô∏è no .blue[&lt;b&gt;ordination&lt;/b&gt;]
&lt;/p&gt;

---

class: title-slide middle
        
# Time for Exercises 
        
---

layout: false
class: full-screen hide-count

&lt;div class="grid-2-2"&gt;

&lt;div class="extension-tile tileview"&gt;&lt;div&gt;Multi-what? &amp;#10004&lt;/div&gt;&lt;/div&gt;
&lt;div class="extension-tile panelset-tile"&gt;&lt;div&gt;What's new? &amp;#10004&lt;/div&gt;&lt;/div&gt;
&lt;div class="extension-tile webcam"&gt;&lt;div&gt;Multivariate GLMs &amp;#10004&lt;/div&gt;&lt;/div&gt;
--
&lt;div class="extension-tile editable animated fadeInRight"&gt;&lt;div&gt;Latent Variable Models&lt;/div&gt;&lt;/div&gt;

&lt;/div&gt;

---

## What about gradients? 

&lt;p style="font-size:200%;"&gt; 
üòû .blue[&lt;b&gt;mvabund&lt;/b&gt;]  is no ordination
  - no biplots 
  - no gradients
&lt;/p&gt;

--

&lt;p style="font-size:200%;"&gt; 
üò≠ no &lt;i&gt; true &lt;/i&gt; joint model 
- no proper co-occurrence matrix
&lt;/p&gt;


--

&lt;p style="font-size:200%;"&gt; 
ü•≤ ... but .blue[&lt;b&gt;latent variable models&lt;/b&gt;] can do both
&lt;/p&gt;
  
---

## Latent variable? 

&lt;p style="font-size:200%;"&gt; 
üëÄ  variables can be observed or latent (unobserved)
&lt;/p&gt;
--
&lt;p style="font-size:200%;"&gt; 
üîß latent variables are inferred from observed variables
&lt;/p&gt;
--
&lt;p style="font-size:200%;"&gt; 
‚òùÔ∏è  The axes in an ordination can be understood as latent variables 
&lt;/p&gt;
--
&lt;p style="font-size:200%;"&gt; 
üí≠ Hypothetical constructs 
  - intelligence
  - self-esteem
  - personality
&lt;/p&gt;

---

.footnote[Walker and Jackson (2011)]

## Random Effects Ordination 

&lt;p style="font-size:200%;"&gt; 
-We have data &lt;b&gt;Y&lt;/b&gt; with &lt;i&gt;&lt;b&gt;i&lt;/b&gt;&lt;/i&gt; different sites and &lt;i&gt;&lt;b&gt;p&lt;/b&gt;&lt;/i&gt; different taxa
&lt;/p&gt;

--

&lt;p style="font-size:200%;"&gt; 
- We want to replace &lt;b&gt;Y&lt;/b&gt; [i x p] with X [i x d], where p &gt; d 
&lt;/p&gt;

--

&lt;p style="font-size:200%;"&gt; 
- X contains the d latent variables  
&lt;/p&gt;

---

.footnote[Walker and Jackson (2011)]

## Random Effects Ordination 

- `\(\huge \hat{y}_{ij} = a_j + \sum_{k=1}^{d} b_{jk} x_{ik}\ \text{or}\ \mathbf{a} + \mathbf{B}\mathbf{x_i}\)`

--

- `\(\huge (y_i - \hat{y_i})\sim N(\hat{y}_{ij}, \psi_j)\)`

--

- `\(\huge \hat{a} = \hat{y} \equiv \frac{1}{n} \sum_{i = 1}^{n} y_i\)`; `\(\huge \hat{\mathbf{S}}=\frac{1}{n} \sum_{i=1}^n\left(\mathbf{y}_i-\overline{\mathbf{y}}\right)\left(\mathbf{y}_i-\overline{\mathbf{y}}\right)^{\prime}\)`

--

- `\(\huge \mathbf{C} = BB^T + \Psi\)`

--

- `\(\huge \mathcal{L}(\hat{\mathbf{a}}, \mathbf{B}, \boldsymbol{\psi})=-\frac{n}{2}\left[p \log (2 \pi)+\log |\mathbf{C}|+\operatorname{tr}\left(\mathbf{C}^{-1} \hat{\mathbf{S}}\right)\right]\)`

--

- `\(\huge \hat{\mathbf{x}}_i=\hat{\mathbf{B}}^{\prime} \hat{\mathbf{C}}^{-1}\left(\mathbf{y}_i-\hat{\mathbf{a}}\right)\)`

---

.footnote[Walker and Jackson (2011)]

## Random Effects Ordination

&lt;p style="font-size:200%;"&gt; 
- unconstrained ordination for normal data 
&lt;/p&gt;

--

&lt;p style="font-size:200%;"&gt; 
- version for presence-absence data available but constrained to 2 dimensions
&lt;/p&gt;

--

&lt;p style="font-size:200%;"&gt; 
- not used much
&lt;/p&gt;

---

.center[
        &lt;img src="images/walker2011_1.png" width="700"&gt;
]

---

.footnote[Hui et al. (2015)]

## Model-based unconstrained ordination  

.w-50.pr3.fl[
&lt;p style="font-size:200%;"&gt; extend REO to all GLMs &lt;/p&gt;

--

`\(\huge g(\mu_{ij}|Z_i) = \alpha_i + \beta_j + z_i\lambda_j\)`
]
--
.w-50.pr3.fl[
.center[
        &lt;img src="images/hui15.png" width="500"&gt;
]
]
---

.center[
        &lt;img src="images/warton15.png" width="900"&gt;
]

---

&lt;p style="font-size:200%;"&gt;True joint model &lt;/p&gt;

`$$\huge \hat{y}_{is} = \beta_{0s} + \beta_s x_i + u_{ij}$$`
--

$$\huge  u_{ij} \sim N(0, \Sigma) $$
--

&lt;p style="font-size:200%;"&gt; With latent variables: &lt;/p&gt;

$$\huge  u_{ij} = z_i\lambda_j $$
--

`$$\huge \Lambda\Lambda^T = \Sigma$$`

---

## BORAL

.footnote[Hui (2016b)]    

&lt;p style="font-size:200%;"&gt; 
- &lt;b&gt;.blue[B]&lt;/b&gt;ayesian &lt;b&gt;.blue[O]&lt;/b&gt;rdination and &lt;b&gt;.blue[R]&lt;/b&gt;egression &lt;b&gt;.blue[A]&lt;/b&gt;na&lt;b&gt;.blue[L]&lt;/b&gt;ysis
&lt;/p&gt; 

--

&lt;p style="font-size:200%;"&gt;
- (un)constrained Ordination with &lt;b&gt;.blue[MCMC]&lt;/b&gt; estimation 
&lt;/p&gt;

--

`$$\huge \alpha_i + \beta_{0s} + \mathbf{\eta_i^T}\mathbf{\lambda_s}$$`
`$$\huge \alpha_i + \beta_{0s} + \mathbf{x_i}^T\boldsymbol{\beta_s} + \mathbf{\eta_i^T}\mathbf{\lambda_s}$$`

---

### Latent variables in ecology 

.footnote[Dormann *et al* (2018), Blanchet *et al.* (2020)]

- &lt;p style="font-size:125%;"&gt; a spatial signal&lt;/p&gt;

- &lt;p style="font-size:125%;"&gt; unmeasured environmental variables &lt;/p&gt;

- &lt;p style="font-size:125%;"&gt; a measure of co-occurrence ... &lt;/p&gt;

--

- &lt;p style="font-size:125%;"&gt; ... however: &lt;/p&gt;

  - &lt;p style="font-size:125%;"&gt; species occurrences depend on the environment  &lt;/p&gt;

--
        
  - &lt;p style="font-size:125%;"&gt; indirect species associations   &lt;/p&gt;

--
        
  - &lt;p style="font-size:125%;"&gt; interactions are often asymmetric &lt;/p&gt;
  
---

## BORAL in Action
 

 

                

```r
# Unconstrained Ordination 
pacman::p_load(boral, rjags, mvabund, UncertainOrd)
data(spider)
Y &lt;- spider$abund
fit_unconstrained_po &lt;- boral(y = Y,
                              family = "poisson",
                              lv.control = list(num.lv = 2),
                              row.eff = "fixed",
                              save.model=TRUE)
summary(fit_unconstrained_po)
```

---

## BORAL in Action

.scroll-output[

```
## $call
## boral.default(y = Y, family = "poisson", lv.control = list(num.lv = 2), 
##     row.eff = "fixed", save.model = T)
## 
## $coefficients
##           coefficients
## cols        beta0 theta1 theta2
##   Alopacce  2.845  2.252  0.000
##   Alopcune  2.741 -0.929  0.134
##   Alopfabr  1.472  2.989  1.047
##   Arctlute -1.315 -1.797 -2.054
##   Arctperi -2.611  4.192  3.713
##   Auloalbi  1.156 -2.791  0.158
##   Pardlugu  1.594 -1.541  3.009
##   Pardmont  3.016  1.590 -1.730
##   Pardnigr  1.048 -2.651 -1.887
##   Pardpull  2.652 -2.054 -0.883
##   Trocterr  4.181 -1.863  0.570
##   Zoraspin  2.142 -2.189  0.270
## 
## $lvs
##     lv
## rows    lv1    lv2
##   1  -0.075 -0.708
##   2  -1.619 -0.302
##   3  -0.243 -0.587
##   4  -0.916 -0.676
##   5  -1.136 -1.083
##   6  -0.746 -0.651
##   7  -0.720 -1.011
##   8  -0.474  1.124
##   9   0.319 -1.373
##   10  0.764 -1.113
##   11  0.654 -1.144
##   12  0.314 -0.923
##   13 -0.567 -0.730
##   14 -0.666 -0.535
##   15 -0.891  0.768
##   16 -0.715  0.555
##   17 -0.795  0.575
##   18 -0.638  0.710
##   19 -0.709  0.910
##   20 -0.612  0.979
##   21 -0.436  1.024
##   22  1.191  0.603
##   23  1.010  0.589
##   24  1.504  0.436
##   25  0.194 -0.076
##   26  1.204  1.255
##   27  1.355  0.314
##   28  1.041  0.251
## 
## $row.coefficients
## $row.coefficients[[1]]
##      1      2      3      4      5      6      7      8      9     10     11     12     13     14     15 
##  0.000 -2.869 -0.070 -0.947 -1.354 -1.012 -0.343 -1.922 -2.736 -3.107 -1.516 -0.620 -0.103 -0.579 -3.322 
##     16     17     18     19     20     21     22     23     24     25     26     27     28 
## -2.659 -3.258 -2.989 -3.072 -3.009 -2.753 -3.207 -2.272 -3.626 -0.893 -4.411 -2.962 -2.425 
## 
## 
## $est
## [1] "median"
## 
## $trial.size
##  [1] 0 0 0 0 0 0 0 0 0 0 0 0
## 
## $num.ord.levels
## [1] 0
## 
## $prior.control
## $prior.control$ssvs.index
## [1] -1
## 
## 
## attr(,"class")
## [1] "summary.boral"
```
]

---

## Check model assumptions
        
        
&lt;img src="index_files/figure-html/check-boral-ucpo-1.png" style="display: block; margin: auto;" /&gt;

---

## Check model assumptions - NB
&lt;img src="index_files/figure-html/check boral 2-1.png" style="display: block; margin: auto;" /&gt;

---

## Ordination Diagram

&lt;img src="index_files/figure-html/ordiplot boral 1-1.png" style="display: block; margin: auto;" /&gt;

---

## Constrained Ordination 




```r
X &lt;- scale(spider$x)

fit_constrained_nb &lt;-
        boral(
                y = Y,
                X = X,
                family = "negative.binomial",
                lv.control = list(num.lv = 2),
                save.model = TRUE
        )

summary(fit_constrained_nb)
```

---

## Constrained Ordination 

.scroll-output[

```
## $call
## boral.default(y = Y, X = X, family = "negative.binomial", lv.control = list(num.lv = 2), 
##     save.model = TRUE)
## 
## $coefficients
##           coefficients
## cols        beta0 theta1 theta2 Dispersion
##   Alopacce -0.848  0.995  0.000      0.172
##   Alopcune -0.033  1.455  1.269      0.420
##   Alopfabr -2.677  1.615 -0.206      1.099
##   Arctlute -3.761  1.133  1.101      3.002
##   Arctperi -4.942 -0.214 -0.666      2.274
##   Auloalbi -2.135  0.990  1.001      0.557
##   Pardlugu -0.138  0.155  0.347      0.454
##   Pardmont  1.196  1.015  0.292      0.652
##   Pardnigr -0.509  1.249  1.743      0.228
##   Pardpull -1.174  0.886  1.295      0.118
##   Trocterr  2.565  0.207  0.781      0.071
##   Zoraspin -0.183  0.171  1.527      0.311
## 
## $lvs
##     lv
## rows    lv1    lv2
##   1   0.056  1.078
##   2  -0.247 -0.144
##   3   0.253  0.523
##   4  -0.474  0.916
##   5   0.189  0.013
##   6   0.477  0.834
##   7   0.148 -0.078
##   8   0.670  0.125
##   9  -0.424 -0.411
##   10 -0.372 -0.494
##   11  0.395 -0.555
##   12  0.316  0.272
##   13  0.701  0.272
##   14 -0.707  0.077
##   15 -0.881 -0.645
##   16  0.129  0.578
##   17 -0.952 -0.775
##   18 -0.373 -0.937
##   19 -0.194  0.339
##   20 -0.032  0.193
##   21  0.162 -0.202
##   22  0.527  0.020
##   23 -0.379 -0.051
##   24 -0.292 -0.831
##   25  0.816  0.513
##   26 -0.931 -0.034
##   27 -0.150 -0.616
##   28 -0.343  0.260
## 
## $X.coefficients
##           coefficients
## cols       soil.dry bare.sand fallen.leaves   moss herb.layer reflection
##   Alopacce   -0.868    -0.019        -0.979  0.101      1.023      1.873
##   Alopcune    1.058    -1.134         0.205 -0.282      0.520      0.658
##   Alopfabr   -1.039     1.394        -0.702  0.169      0.652      1.963
##   Arctlute    3.209     0.216        -1.524  0.114      1.691     -0.670
##   Arctperi   -2.198     1.067         0.851  0.479     -0.583      1.666
##   Auloalbi    0.426    -0.355         0.836  0.157      4.439     -0.936
##   Pardlugu   -1.634    -1.021         0.943 -0.670      0.616     -1.271
##   Pardmont    1.247     0.274        -1.042  1.547      1.099     -0.148
##   Pardnigr    1.862    -0.295        -1.526 -0.826      1.038     -0.785
##   Pardpull    2.662    -1.071        -0.819  0.518      2.431     -0.537
##   Trocterr    0.803    -0.405        -0.195 -0.489      0.570     -0.242
##   Zoraspin    1.357     0.203        -0.677 -0.716      1.003     -1.297
## 
## $est
## [1] "median"
## 
## $trial.size
##  [1] 0 0 0 0 0 0 0 0 0 0 0 0
## 
## $num.ord.levels
## [1] 0
## 
## $prior.control
## $prior.control$ssvs.index
## [1] -1 -1 -1 -1 -1 -1
## 
## 
## attr(,"class")
## [1] "summary.boral"
```
]
  
---
## Ordination Diagram 

&lt;img src="index_files/figure-html/ordiplot boral 2-1.png" style="display: block; margin: auto;" /&gt;

---
## Correlation plots 
&lt;img src="index_files/figure-html/boral correlation plots-1.png" style="display: block; margin: auto;" /&gt;

---

## Correlation plots 

&lt;img src="index_files/figure-html/boral correlation plots2-1.png" style="display: block; margin: auto;" /&gt;

---

## Uncertainty in latent variable models
- R package UncertainOrd (Hoegh &amp; Roberts, 2020)
- based on 95% credible intervals



&lt;img src="index_files/figure-html/unnamed-chunk-13-1.png" style="display: block; margin: auto;" /&gt;

---
## Uncertainty in latent variable models
- R package UncertainOrd (Hoegh &amp; Roberts, 2020)
- based on 95% credible intervals

&lt;img src="index_files/figure-html/unnamed-chunk-14-1.png" style="display: block; margin: auto;" /&gt;

---

## Uncertainty in latent variable models
- R package UncertainOrd (Hoegh &amp; Roberts, 2020)
- based on 95% credible intervals

&lt;img src="index_files/figure-html/unnamed-chunk-15-1.png" style="display: block; margin: auto;" /&gt;

---

## Can we include traits in this? 
   
&lt;p style="font-size:150%;"&gt;        
- as parameters for the priors  
&lt;/p&gt;

--

`\(\huge \beta_{0s} \sim N(t_j^T \kappa_0, \mathbf{\sigma}^2_0)\)` &lt;br&gt;
`\(\huge \beta_{sp} \sim N(\mathbf{t_s^T \kappa_p, \sigma^2_p})\)`

--

&lt;p style="font-size:150%;"&gt; 
- The mean of the normal distribution from which species-specific intercept and regression coefficients are drawn depends on traits (t) and a trait coefficient Œ∫. 
&lt;/p&gt;

---

class: center,middle


`$$\huge y_{is} = a_i + \beta_{0s} + x^T \beta + \eta^T \lambda + \epsilon$$` 
--
`$$\huge a_i \sim N(0,20)$$` 
--
`$$\huge \beta_{0s} \sim N(\mu_{s}, \sigma^2_0)$$` 
--
`$$\huge \mu_{\beta_{0s}} = t_s^T \kappa_0$$` 
--
`$$\huge \beta_{sp} \sim N(\boldsymbol{\mu}_{\beta_{sp}},\boldsymbol{\Sigma})$$` 
--
`$$\huge \mu_{\beta_sp} = t_s^T \kappa_{sp}$$` 
--
`$$\huge \lambda_s \sim N(0,20)$$` 

---

## GLLVM package 

&lt;p style="font-size:200%;"&gt;
üì¶  R package gllvm (Niku &lt;i&gt;et al.&lt;/i&gt;, 2019b)
&lt;/p&gt;
--
&lt;p style="font-size:200%;"&gt;
üîÇ Maximum Likelihood instead of MCMC 
&lt;/p&gt;
--
&lt;p style="font-size:200%;"&gt;
üèÉ faster than boral!
&lt;/p&gt;
--
&lt;p style="font-size:200%;"&gt;
ü•≤  no posterior, no UncertainOrd ... but prediction regions 
&lt;/p&gt;
--
&lt;p style="font-size:200%;"&gt;
üü¶ quadratic responses to latent variables
&lt;/p&gt;


---



```r
library(gllvm)
data("antTraits")
y &lt;- as.matrix(antTraits$abund)
X &lt;- scale(as.matrix(antTraits$env))
TR &lt;- antTraits$traits
fit_uo_po &lt;- gllvm(y, family = poisson())
fit_uo_nb &lt;- gllvm(y, family = "negative.binomial")
```



--


```
## Call: 
## gllvm(y = y, family = poisson())
## family: 
## [1] "poisson"
## method: 
## [1] "VA"
## 
## log-likelihood:  -2098.631 
## Residual degrees of freedom:  1149 
## AIC:  4359.261 
## AICc:  4370.833 
## BIC:  4773.558
```

---

### Residual Diagnostics

&lt;img src="index_files/figure-html/gllvm-in-action-21-1.png" style="display: block; margin: auto;" /&gt;

---

###  Residual Diagnostics

&lt;img src="index_files/figure-html/gllvm-in-action-22-1.png" style="display: block; margin: auto;" /&gt;

---

### Residual Diagnostics

&lt;img src="index_files/figure-html/gllvm-in-action-23-1.png" style="display: block; margin: auto;" /&gt;

---

&lt;img src="index_files/figure-html/gllvm-uc-biplot-1.png" style="display: block; margin: auto;" /&gt;

---

&lt;img src="index_files/figure-html/gllvm-uc-biplot2 -1.png" style="display: block; margin: auto;" /&gt;

---

### Constrained Ordination 


```r
fit_co_nb2 &lt;- gllvm(y, X, num.lv = 2,
                    formula = ~ Bare.ground + Shrub.cover +
                            Volume.lying.CWD,
                    family = "negative.binomial")
fit_co_nb3 &lt;- gllvm(y, X, num.lv = 3,
                    formula = ~ Bare.ground + Shrub.cover +
                            Volume.lying.CWD,
                    family = "negative.binomial")
AIC(fit_co_nb2, fit_co_nb3)
```


```
##             df      AIC
## fit_co_nb2 245 4036.933
## fit_co_nb3 284 4113.655
```

---

&lt;img src="index_files/figure-html/gllvm-co-biplot-1.png" style="display: block; margin: auto;" /&gt;

---

&lt;img src="index_files/figure-html/gllvm-co-coefficient-plot-1.png" style="display: block; margin: auto;" /&gt;

---

.center[
        &lt;img src="images/gllvm_corrplot1.png" width="650"&gt;
]

---

### Including traits 


```r
fit_4th &lt;- gllvm(
        y = y,
        X = X,
        TR = TR,
        family = "negative.binomial",
        num.lv = 2,
        formula = y ~
                (Bare.ground + Shrub.cover + Volume.lying.CWD) +
                (Bare.ground + Shrub.cover + Volume.lying.CWD):(Pilosity + Polymorphism + Webers.length)
)
```



---

### Fourth Corner Interaction Plot
&lt;img src="index_files/figure-html/gllvm-fourth-corner-interaction-plot-1.png" style="display: block; margin: auto;" /&gt;

---

### Do Traits matter here? 

```r
fit_4th2 &lt;- gllvm(y, X, TR, family = "negative.binomial", 
                  num.lv = 2, formula = y ~ (Bare.ground + 
                  Shrub.cover + Volume.lying.CWD))
anova(fit_4th, fit_4th2)
```


--

```
##   Resid.Df       D Df.diff   P.value
## 1     1064  0.0000       0          
## 2     1046 26.4091      18 0.0907652
```

---

.footnote[van der Veen *et al.* (2021)]

### Quadratic Responses to latent variables

- Similar notion to Gaussian Ordination, CCA, CQO
- Until now all responses to latent gradients were linear: `\(z_i\lambda\)`
- Responses of taxa are often unimodal - requiring a quadratic fit

`$$\huge g\left\{E\left(y_{i j} \mid z_i\right)\right\}=c_j-\sum_{q=1}^d\left\{\frac{\left(z_{i q}-u_{j q}\right)^2}{2 t_{j q}^2}\right\}$$`
- `\(c_j\)` maximum of species `\(j\)`
- `\(d\)` latent variables
- `\(u\)` optimum location for specise `\(j\)` along gradient `\(q\)`
- `\(t\)` tolerance of species `\(j\)`

---


```r
# one tolerance per Latent Variable
ftComTol  &lt;- gllvm(y, family = "negative.binomial", num.lv = 2, quadratic = "LV")
# one tolerance per Latent Variable and species
ftUneqTol &lt;- gllvm(y, family = "negative.binomial", num.lv = 2, quadratic = TRUE)
```



--


```r
AIC(fit_uo_nb, ftComTol, ftUneqTol)
```

```
##            df      AIC
## fit_uo_nb 122 3974.170
## ftComTol  165 4047.491
## ftUneqTol 245 4068.461
```

---


```r
head(optima(ftUneqTol)$optima)
```

```
##                                       LV1           LV2
## Amblyopone.australis         1.940891e-02  0.0000000000
## Aphaenogaster.longiceps     -1.359809e+03  0.0009793424
## Camponotus.cinereus.amperei -5.341865e-02  0.2723341175
## Camponotus.claripes         -4.226795e-02  0.0076779714
## Camponotus.consobrinus       1.078585e-02  0.1587483507
## Camponotus.nigriceps        -1.170548e+03 -0.0068614844
```

```r
head(tolerances(ftUneqTol)$tolerances)
```

```
##                                     LV1        LV2
## Amblyopone.australis         0.13931586 0.10408638
## Aphaenogaster.longiceps      4.05799994 0.03129445
## Camponotus.cinereus.amperei  0.04002908 0.10776896
## Camponotus.claripes          0.04821086 0.04189844
## Camponotus.consobrinus       0.03040472 0.11409241
## Camponotus.nigriceps        11.94725966 0.03150506
```

---

.footnote[van der Veen *et al.* (2022)]

### True Constrained ordination

- so far model-based ordinations with predictors only showed residuals

--

- True constrained ordination is available through reduced rank regression

--

- All latent variables are restricted to be combinations of predictor variables

--

- This is only feasible if predictors explain most of variance

--

- Alternative: include predictors and error term in latent variable (concurrent ordination)

--

- `\(g\left\{\mathrm{E}\left(y_{i j} \mid \mathrm{x}_{l v, i}, \epsilon_i\right)\right\}=\beta_{0 j}+\mathrm{x}_{l v, i}^{\top} \mathrm{B} \gamma_j+\epsilon_i^{\top} \gamma_j\)`

- `\(\gamma\)` species loadings

---


```r
RRR   &lt;- gllvm(y = y,
               X = X,
               family = "negative.binomial",
               num.RR = 2)
```



--

.scroll-output[

```r
summary(RRR)
```

```
## 
## Call:
## gllvm(y = y, X = X, family = "negative.binomial", num.RR = 2)
## 
## Family:  negative.binomial 
## 
## AIC:  4008.426 AICc:  4063.327 BIC:  4877.937 LL:  -1834.2 df:  170 
## 
## Informed LVs:  0 
## Constrained LVs:  2 
## Unconstrained LVs:  0 
## 
## Formula:  ~ 1 
## LV formula:  ~Bare.ground + Canopy.cover + Shrub.cover + Volume.lying.CWD + Feral.mammal.dung 
## 
## Coefficients LV predictors:
##                          Estimate Std. Error z value Pr(&gt;|z|)  
## Bare.ground(CLV1)        0.094242   0.040083   2.351   0.0187 *
## Canopy.cover(CLV1)      -0.036536   0.521730  -0.070   0.9442  
## Shrub.cover(CLV1)        0.073732   0.034767   2.121   0.0339 *
## Volume.lying.CWD(CLV1)   0.090805   0.145017   0.626   0.5312  
## Feral.mammal.dung(CLV1)  0.002983   0.023538   0.127   0.8992  
## Bare.ground(CLV2)        0.210500   0.103621   2.031   0.0422 *
## Canopy.cover(CLV2)       2.843892   1.373948   2.070   0.0385 *
## Shrub.cover(CLV2)        0.123177   0.084499   1.458   0.1449  
## Volume.lying.CWD(CLV2)   0.825747   0.475137   1.738   0.0822 .
## Feral.mammal.dung(CLV2) -0.038003   0.061633  -0.617   0.5375  
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
```
]

---

&lt;img src="index_files/figure-html/unnamed-chunk-21-1.png" style="display: block; margin: auto;" /&gt;


---

```r
CGLLVM &lt;- gllvm(y, 
                      X = X, 
                      family = "negative.binomial", 
                      num.lv.c = 2)
```


--

.scroll-output[

```r
summary(CGLLVM)
```

```
## 
## Call:
## gllvm(y = y, X = X, family = "negative.binomial", num.lv.c = 2)
## 
## Family:  negative.binomial 
## 
## AIC:  3997.668 AICc:  4053.971 BIC:  4877.409 LL:  -1826.8 df:  172 
## 
## Informed LVs:  2 
## Constrained LVs:  0 
## Unconstrained LVs:  0 
## Residual standard deviation of LVs:  0.6926 0 
## 
## Formula:  ~ 1 
## LV formula:  ~Bare.ground + Canopy.cover + Shrub.cover + Volume.lying.CWD + Feral.mammal.dung 
## 
## Coefficients LV predictors:
##                         Estimate Std. Error z value Pr(&gt;|z|)  
## Bare.ground(CLV1)        0.05690    0.19518   0.292   0.7706  
## Canopy.cover(CLV1)       0.05332    0.38350   0.139   0.8894  
## Shrub.cover(CLV1)        0.49719    0.29860   1.665   0.0959 .
## Volume.lying.CWD(CLV1)   0.28237    0.23250   1.215   0.2246  
## Feral.mammal.dung(CLV1)  0.07611    0.18002   0.423   0.6725  
## Bare.ground(CLV2)        0.16277    0.18255   0.892   0.3726  
## Canopy.cover(CLV2)       2.68563    1.11300   2.413   0.0158 *
## Shrub.cover(CLV2)       -0.40295    0.26727  -1.508   0.1317  
## Volume.lying.CWD(CLV2)   0.21412    0.24825   0.863   0.3884  
## Feral.mammal.dung(CLV2) -0.28472    0.20167  -1.412   0.1580  
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
```
]

---



```r
partR2.gllvm(CGLLVM)
```

```
## R^2 for latent variables: 0.1911 
##  
## Partial R^2 for predictors and all LVs: 
##       Bare.ground      Canopy.cover       Shrub.cover  Volume.lying.CWD Feral.mammal.dung 
##            0.0253            0.1298            0.0904            0.0495            0.0390
```


---

&lt;img src="index_files/figure-html/unnamed-chunk-27-1.png" style="display: block; margin: auto;" /&gt;

---

class: title-slide middle
        
# Time for Exercises 
        

    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="assets/remark-0.14.0.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "atom-one-light",
"highlightLines": true,
"ratio": "16:9",
"countIncrementalSlides": true,
"slideNumberFormat": "%current%"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
