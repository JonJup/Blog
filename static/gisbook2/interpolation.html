<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Interpolation | Spatial Data Science in R</title>
  <meta name="description" content="Lessons and tasks from GIS courses by Jonathan Jupke" />
  <meta name="generator" content="bookdown 0.41 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Interpolation | Spatial Data Science in R" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Lessons and tasks from GIS courses by Jonathan Jupke" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Interpolation | Spatial Data Science in R" />
  
  <meta name="twitter:description" content="Lessons and tasks from GIS courses by Jonathan Jupke" />
  

<meta name="author" content="Jonathan Jupke" />


<meta name="date" content="2024-12-06" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="point-pattern-analysis.html"/>
<link rel="next" href="machine-learning.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<link href="libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.2.2/leaflet.js"></script>
<script src="libs/leaflet-providers-2.0.0/leaflet-providers_2.0.0.js"></script>
<script src="libs/leaflet-providers-plugin-2.2.2/leaflet-providers-plugin.js"></script>
<link href="libs/HomeButton-0.0.1/home-button.css" rel="stylesheet" />
<script src="libs/HomeButton-0.0.1/home-button.js"></script>
<script src="libs/HomeButton-0.0.1/easy-button-src.min.js"></script>
<script src="libs/clipboard-0.0.1/setClipboardText.js"></script>
<link href="libs/mapviewCSS-0.0.1/mapview-popup.css" rel="stylesheet" />
<link href="libs/mapviewCSS-0.0.1/mapview.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Spatial Data Science in R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="introduction-to-the-sf-package.html"><a href="introduction-to-the-sf-package.html"><i class="fa fa-check"></i><b>1</b> Introduction to the sf package</a>
<ul>
<li class="chapter" data-level="1.1" data-path="introduction-to-the-sf-package.html"><a href="introduction-to-the-sf-package.html#loading-spatial-data-into-r"><i class="fa fa-check"></i><b>1.1</b> Loading spatial data into R</a></li>
<li class="chapter" data-level="1.2" data-path="introduction-to-the-sf-package.html"><a href="introduction-to-the-sf-package.html#creating-spatial-data-yourself"><i class="fa fa-check"></i><b>1.2</b> Creating spatial data yourself</a></li>
<li class="chapter" data-level="1.3" data-path="introduction-to-the-sf-package.html"><a href="introduction-to-the-sf-package.html#basic-operations"><i class="fa fa-check"></i><b>1.3</b> Basic operations</a></li>
<li class="chapter" data-level="1.4" data-path="introduction-to-the-sf-package.html"><a href="introduction-to-the-sf-package.html#useful-functions"><i class="fa fa-check"></i><b>1.4</b> Useful functions</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="introduction-to-the-sf-package.html"><a href="introduction-to-the-sf-package.html#st_area"><i class="fa fa-check"></i><b>1.4.1</b> <code>st_area</code></a></li>
<li class="chapter" data-level="1.4.2" data-path="introduction-to-the-sf-package.html"><a href="introduction-to-the-sf-package.html#st_bbox"><i class="fa fa-check"></i><b>1.4.2</b> <code>st_bbox()</code></a></li>
<li class="chapter" data-level="1.4.3" data-path="introduction-to-the-sf-package.html"><a href="introduction-to-the-sf-package.html#st_buffer"><i class="fa fa-check"></i><b>1.4.3</b> <code>st_buffer()</code></a></li>
<li class="chapter" data-level="1.4.4" data-path="introduction-to-the-sf-package.html"><a href="introduction-to-the-sf-package.html#st_coordinates"><i class="fa fa-check"></i><b>1.4.4</b> <code>st_coordinates()</code></a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="introduction-to-the-sf-package.html"><a href="introduction-to-the-sf-package.html#geometric-set-operations"><i class="fa fa-check"></i><b>1.5</b> Geometric set operations</a>
<ul>
<li class="chapter" data-level="1.5.1" data-path="introduction-to-the-sf-package.html"><a href="introduction-to-the-sf-package.html#st_distance"><i class="fa fa-check"></i><b>1.5.1</b> <code>st_distance</code></a></li>
<li class="chapter" data-level="1.5.2" data-path="introduction-to-the-sf-package.html"><a href="introduction-to-the-sf-package.html#st_nearest_feature"><i class="fa fa-check"></i><b>1.5.2</b> <code>st_nearest_feature</code></a></li>
<li class="chapter" data-level="1.5.3" data-path="introduction-to-the-sf-package.html"><a href="introduction-to-the-sf-package.html#spatial-subsetting"><i class="fa fa-check"></i><b>1.5.3</b> spatial subsetting</a></li>
<li class="chapter" data-level="1.5.4" data-path="introduction-to-the-sf-package.html"><a href="introduction-to-the-sf-package.html#spatial-joins"><i class="fa fa-check"></i><b>1.5.4</b> spatial joins</a></li>
<li class="chapter" data-level="1.5.5" data-path="introduction-to-the-sf-package.html"><a href="introduction-to-the-sf-package.html#spatial-sggregation"><i class="fa fa-check"></i><b>1.5.5</b> spatial sggregation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="rasters-in-r-the-terra-package.html"><a href="rasters-in-r-the-terra-package.html"><i class="fa fa-check"></i><b>2</b> Rasters in R: The terra package</a>
<ul>
<li class="chapter" data-level="2.1" data-path="rasters-in-r-the-terra-package.html"><a href="rasters-in-r-the-terra-package.html#basic-idea"><i class="fa fa-check"></i><b>2.1</b> Basic idea</a></li>
<li class="chapter" data-level="2.2" data-path="rasters-in-r-the-terra-package.html"><a href="rasters-in-r-the-terra-package.html#creating-a-new-raster"><i class="fa fa-check"></i><b>2.2</b> Creating a new Raster</a></li>
<li class="chapter" data-level="2.3" data-path="rasters-in-r-the-terra-package.html"><a href="rasters-in-r-the-terra-package.html#going-beyond-the-hull"><i class="fa fa-check"></i><b>2.3</b> Going beyond the hull</a></li>
<li class="chapter" data-level="2.4" data-path="rasters-in-r-the-terra-package.html"><a href="rasters-in-r-the-terra-package.html#multiple-layers-in-one-spatraster"><i class="fa fa-check"></i><b>2.4</b> Multiple layers in one SpatRaster</a></li>
<li class="chapter" data-level="2.5" data-path="rasters-in-r-the-terra-package.html"><a href="rasters-in-r-the-terra-package.html#raster-algebra"><i class="fa fa-check"></i><b>2.5</b> Raster algebra</a></li>
<li class="chapter" data-level="2.6" data-path="rasters-in-r-the-terra-package.html"><a href="rasters-in-r-the-terra-package.html#high-level-functions"><i class="fa fa-check"></i><b>2.6</b> High-level functions</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="rasters-in-r-the-terra-package.html"><a href="rasters-in-r-the-terra-package.html#extracting-raster-values-with-vectors"><i class="fa fa-check"></i><b>2.6.1</b> Extracting raster values with vectors</a></li>
<li class="chapter" data-level="2.6.2" data-path="rasters-in-r-the-terra-package.html"><a href="rasters-in-r-the-terra-package.html#masking"><i class="fa fa-check"></i><b>2.6.2</b> Masking</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="rasters-in-r-the-terra-package.html"><a href="rasters-in-r-the-terra-package.html#cell-level-functions"><i class="fa fa-check"></i><b>2.7</b> Cell-level functions</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="point-pattern-analysis.html"><a href="point-pattern-analysis.html"><i class="fa fa-check"></i><b>3</b> Point Pattern Analysis</a>
<ul>
<li class="chapter" data-level="3.1" data-path="point-pattern-analysis.html"><a href="point-pattern-analysis.html#the-ppp-class"><i class="fa fa-check"></i><b>3.1</b> the ppp class</a></li>
<li class="chapter" data-level="3.2" data-path="point-pattern-analysis.html"><a href="point-pattern-analysis.html#first-order-processes"><i class="fa fa-check"></i><b>3.2</b> First order processes</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="point-pattern-analysis.html"><a href="point-pattern-analysis.html#kernel-density"><i class="fa fa-check"></i><b>3.2.1</b> Kernel density</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="point-pattern-analysis.html"><a href="point-pattern-analysis.html#second-order-processes"><i class="fa fa-check"></i><b>3.3</b> Second order processes</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="point-pattern-analysis.html"><a href="point-pattern-analysis.html#average-nearest-neighbor"><i class="fa fa-check"></i><b>3.3.1</b> Average nearest neighbor</a></li>
<li class="chapter" data-level="3.3.2" data-path="point-pattern-analysis.html"><a href="point-pattern-analysis.html#the-k-funktion"><i class="fa fa-check"></i><b>3.3.2</b> The K-Funktion</a></li>
<li class="chapter" data-level="3.3.3" data-path="point-pattern-analysis.html"><a href="point-pattern-analysis.html#morans-i"><i class="fa fa-check"></i><b>3.3.3</b> Morans I</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="interpolation.html"><a href="interpolation.html"><i class="fa fa-check"></i><b>4</b> Interpolation</a>
<ul>
<li class="chapter" data-level="4.1" data-path="interpolation.html"><a href="interpolation.html#the-data"><i class="fa fa-check"></i><b>4.1</b> The data</a></li>
<li class="chapter" data-level="4.2" data-path="interpolation.html"><a href="interpolation.html#proximity-polygons"><i class="fa fa-check"></i><b>4.2</b> Proximity Polygons</a></li>
<li class="chapter" data-level="4.3" data-path="interpolation.html"><a href="interpolation.html#trend-surface-analysis"><i class="fa fa-check"></i><b>4.3</b> Trend Surface Analysis</a></li>
<li class="chapter" data-level="4.4" data-path="interpolation.html"><a href="interpolation.html#splines"><i class="fa fa-check"></i><b>4.4</b> Splines</a></li>
<li class="chapter" data-level="4.5" data-path="interpolation.html"><a href="interpolation.html#weighted-averaging"><i class="fa fa-check"></i><b>4.5</b> Weighted averaging</a></li>
<li class="chapter" data-level="4.6" data-path="interpolation.html"><a href="interpolation.html#kriging"><i class="fa fa-check"></i><b>4.6</b> Kriging</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="machine-learning.html"><a href="machine-learning.html"><i class="fa fa-check"></i><b>5</b> Machine Learning</a>
<ul>
<li class="chapter" data-level="5.1" data-path="machine-learning.html"><a href="machine-learning.html#terrain-analysis-with-terra"><i class="fa fa-check"></i><b>5.1</b> Terrain analysis with terra</a></li>
<li class="chapter" data-level="5.2" data-path="machine-learning.html"><a href="machine-learning.html#ploting-the-data"><i class="fa fa-check"></i><b>5.2</b> Ploting the data</a></li>
<li class="chapter" data-level="5.3" data-path="machine-learning.html"><a href="machine-learning.html#logistic-regression"><i class="fa fa-check"></i><b>5.3</b> Logistic regression</a></li>
<li class="chapter" data-level="5.4" data-path="machine-learning.html"><a href="machine-learning.html#mlr3"><i class="fa fa-check"></i><b>5.4</b> mlr3</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="machine-learning.html"><a href="machine-learning.html#creating-a-task"><i class="fa fa-check"></i><b>5.4.1</b> Creating a <em>task</em></a></li>
<li class="chapter" data-level="5.4.2" data-path="machine-learning.html"><a href="machine-learning.html#the-learner"><i class="fa fa-check"></i><b>5.4.2</b> The <em>learner</em></a></li>
<li class="chapter" data-level="5.4.3" data-path="machine-learning.html"><a href="machine-learning.html#hyperparameter-tuning"><i class="fa fa-check"></i><b>5.4.3</b> Hyperparameter Tuning</a></li>
<li class="chapter" data-level="5.4.4" data-path="machine-learning.html"><a href="machine-learning.html#predictions"><i class="fa fa-check"></i><b>5.4.4</b> Predictions</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="graph-analysis.html"><a href="graph-analysis.html"><i class="fa fa-check"></i><b>6</b> Graph Analysis</a>
<ul>
<li class="chapter" data-level="6.1" data-path="graph-analysis.html"><a href="graph-analysis.html#the-igraph-package"><i class="fa fa-check"></i><b>6.1</b> The igraph package</a></li>
<li class="chapter" data-level="6.2" data-path="graph-analysis.html"><a href="graph-analysis.html#from-data-to-graph"><i class="fa fa-check"></i><b>6.2</b> From data to graph</a></li>
<li class="chapter" data-level="6.3" data-path="graph-analysis.html"><a href="graph-analysis.html#centrality-measures"><i class="fa fa-check"></i><b>6.3</b> Centrality measures</a></li>
<li class="chapter" data-level="6.4" data-path="graph-analysis.html"><a href="graph-analysis.html#visualization"><i class="fa fa-check"></i><b>6.4</b> Visualization</a></li>
<li class="chapter" data-level="6.5" data-path="graph-analysis.html"><a href="graph-analysis.html#network-models"><i class="fa fa-check"></i><b>6.5</b> Network Models</a></li>
<li class="chapter" data-level="6.6" data-path="graph-analysis.html"><a href="graph-analysis.html#optimal-channel-networks"><i class="fa fa-check"></i><b>6.6</b> Optimal Channel Networks</a></li>
<li class="chapter" data-level="6.7" data-path="graph-analysis.html"><a href="graph-analysis.html#sfnetworks"><i class="fa fa-check"></i><b>6.7</b> sfnetworks</a>
<ul>
<li class="chapter" data-level="6.7.1" data-path="graph-analysis.html"><a href="graph-analysis.html#finding-paths-in-the-network"><i class="fa fa-check"></i><b>6.7.1</b> Finding paths in the network</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="creating-maps-in-r.html"><a href="creating-maps-in-r.html"><i class="fa fa-check"></i><b>7</b> Creating Maps in R</a>
<ul>
<li class="chapter" data-level="7.1" data-path="creating-maps-in-r.html"><a href="creating-maps-in-r.html#tmap"><i class="fa fa-check"></i><b>7.1</b> tmap</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="creating-maps-in-r.html"><a href="creating-maps-in-r.html#basic-tmaps"><i class="fa fa-check"></i><b>7.1.1</b> Basic tmaps</a></li>
<li class="chapter" data-level="7.1.2" data-path="creating-maps-in-r.html"><a href="creating-maps-in-r.html#adjusting-visual-elements-and-multiple-groups"><i class="fa fa-check"></i><b>7.1.2</b> Adjusting visual elements and multiple groups</a></li>
<li class="chapter" data-level="7.1.3" data-path="creating-maps-in-r.html"><a href="creating-maps-in-r.html#map-extend"><i class="fa fa-check"></i><b>7.1.3</b> Map extend</a></li>
<li class="chapter" data-level="7.1.4" data-path="creating-maps-in-r.html"><a href="creating-maps-in-r.html#further-map-elements"><i class="fa fa-check"></i><b>7.1.4</b> Further map elements</a></li>
<li class="chapter" data-level="7.1.5" data-path="creating-maps-in-r.html"><a href="creating-maps-in-r.html#making-the-map-prettier"><i class="fa fa-check"></i><b>7.1.5</b> Making the map prettier</a></li>
<li class="chapter" data-level="7.1.6" data-path="creating-maps-in-r.html"><a href="creating-maps-in-r.html#save-to-maps-to-file"><i class="fa fa-check"></i><b>7.1.6</b> Save to maps to file</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="creating-maps-in-r.html"><a href="creating-maps-in-r.html#rastervis"><i class="fa fa-check"></i><b>7.2</b> rasterVis</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="creating-maps-in-r.html"><a href="creating-maps-in-r.html#beyond-the-usual"><i class="fa fa-check"></i><b>7.2.1</b> Beyond the usual</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="creating-maps-in-r.html"><a href="creating-maps-in-r.html#cartographer"><i class="fa fa-check"></i><b>7.3</b> Cartographer</a></li>
<li class="chapter" data-level="7.4" data-path="creating-maps-in-r.html"><a href="creating-maps-in-r.html#rayshader"><i class="fa fa-check"></i><b>7.4</b> Rayshader</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="creating-maps-in-r.html"><a href="creating-maps-in-r.html#setup"><i class="fa fa-check"></i><b>7.4.1</b> Setup</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="where-do-i-get-data.html"><a href="where-do-i-get-data.html"><i class="fa fa-check"></i><b>8</b> Where do I get data❓</a>
<ul>
<li class="chapter" data-level="8.1" data-path="where-do-i-get-data.html"><a href="where-do-i-get-data.html#websites"><i class="fa fa-check"></i><b>8.1</b> Websites</a></li>
<li class="chapter" data-level="8.2" data-path="where-do-i-get-data.html"><a href="where-do-i-get-data.html#packages"><i class="fa fa-check"></i><b>8.2</b> Packages</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="where-do-i-get-data.html"><a href="where-do-i-get-data.html#geodata"><i class="fa fa-check"></i><b>8.2.1</b> geodata</a></li>
<li class="chapter" data-level="8.2.2" data-path="where-do-i-get-data.html"><a href="where-do-i-get-data.html#osmdata"><i class="fa fa-check"></i><b>8.2.2</b> osmdata</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="usefull-packages.html"><a href="usefull-packages.html"><i class="fa fa-check"></i><b>9</b> Usefull packages</a>
<ul>
<li class="chapter" data-level="9.1" data-path="usefull-packages.html"><a href="usefull-packages.html#coordinatecleaner"><i class="fa fa-check"></i><b>9.1</b> ‘CoordinateCleaner’</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>10</b> References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Spatial Data Science in R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="interpolation" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">Chapter 4</span> Interpolation<a href="interpolation.html#interpolation" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>In this tutorial, you will learn how to use R to apply different interpolation methods to your data sets.
We will use couple of R packages that are familiar to us, like <code>sf</code> and <code>mapview</code> but also some new ones.
Most notably, we will use <code>fields</code> <span class="citation">(<a href="#ref-DouglasNychka2021">Douglas Nychka et al. 2021</a>)</span> for splines and <code>gstat</code> <span class="citation">(<a href="#ref-Graeler2016">Gräler, Pebesma, and Heuvelink 2016</a>)</span> as well as <code>automap</code> <span class="citation">(<a href="#ref-Hiemstra2008">Hiemstra et al. 2008</a>)</span> for distance weighting.</p>
<div class="sourceCode" id="cb263"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb263-1"><a href="interpolation.html#cb263-1" tabindex="-1"></a><span class="fu">library</span>(automap)</span>
<span id="cb263-2"><a href="interpolation.html#cb263-2" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb263-3"><a href="interpolation.html#cb263-3" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb263-4"><a href="interpolation.html#cb263-4" tabindex="-1"></a><span class="fu">library</span>(sp)</span>
<span id="cb263-5"><a href="interpolation.html#cb263-5" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb263-6"><a href="interpolation.html#cb263-6" tabindex="-1"></a><span class="fu">library</span>(fields)</span>
<span id="cb263-7"><a href="interpolation.html#cb263-7" tabindex="-1"></a><span class="fu">library</span>(gstat)</span>
<span id="cb263-8"><a href="interpolation.html#cb263-8" tabindex="-1"></a><span class="fu">library</span>(tmap)</span>
<span id="cb263-9"><a href="interpolation.html#cb263-9" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb263-10"><a href="interpolation.html#cb263-10" tabindex="-1"></a><span class="fu">library</span>(mapview)</span></code></pre></div>
<div id="the-data" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> The data<a href="interpolation.html#the-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We will use the LUCAS soil data.
<a href="https://esdac.jrc.ec.europa.eu/projects/lucas">LUCAS</a> is an acronym for Land Use/Land Cover Area Frame Survey.
This data base contains approximately 20.000 soil samples from all EU27 countries with the exceptions of Romania and Bulgaria.
You can download a subset of the LUCAS data base I created for this course <a href="https://seafile.rlp.net/d/c757bff20f1f49f99cb2/">here</a>.</p>
<p>Next, we load the LUCAS data.</p>
<div class="sourceCode" id="cb264"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb264-1"><a href="interpolation.html#cb264-1" tabindex="-1"></a>lucas <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;data/lucas_saxony.rds&quot;</span>)</span></code></pre></div>
<p>As always, we first inspect the new object.</p>
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb265-1"><a href="interpolation.html#cb265-1" tabindex="-1"></a><span class="fu">class</span>(lucas)</span></code></pre></div>
<pre><code>## [1] &quot;sf&quot;         &quot;data.frame&quot;</code></pre>
<p>The <code>glimpse()</code> function from the <code>dplyr</code> package is similar to the <code>str()</code> from base R.</p>
<div class="sourceCode" id="cb267"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb267-1"><a href="interpolation.html#cb267-1" tabindex="-1"></a><span class="fu">glimpse</span>(lucas)</span></code></pre></div>
<pre><code>## Rows: 79
## Columns: 23
## $ Point_ID &lt;int&gt; 44743044, 44763132, 44763142, 44…
## $ Coarse   &lt;int&gt; 34, NA, NA, NA, 23, NA, NA, NA, …
## $ Clay     &lt;int&gt; 22, NA, NA, NA, 22, NA, NA, NA, …
## $ Sand     &lt;int&gt; 26, NA, NA, NA, 18, NA, NA, NA, …
## $ Silt     &lt;int&gt; 52, NA, NA, NA, 60, NA, NA, NA, …
## $ pH_CaCl2 &lt;dbl&gt; 5.4, 6.5, 6.6, 7.3, 5.3, 6.5, 6.…
## $ pH_H20   &lt;dbl&gt; 5.77, 6.55, 6.82, 7.70, 5.53, 6.…
## $ EC       &lt;dbl&gt; 8.52, 22.00, 17.34, 24.90, 38.90…
## $ OC       &lt;dbl&gt; 36.3, 19.9, 15.7, 20.6, 34.1, 17…
## $ CaCO3    &lt;int&gt; 0, 2, 0, 16, 0, 1, 0, 2, 0, 0, 0…
## $ P        &lt;dbl&gt; 60.0, 48.2, 67.7, 4.6, 45.0, 44.…
## $ N        &lt;dbl&gt; 4.1, 2.1, 1.8, 0.9, 4.3, 1.9, 1.…
## $ K        &lt;dbl&gt; 103.4, 192.1, 265.8, 90.1, 328.2…
## $ LC       &lt;chr&gt; &quot;E10&quot;, &quot;B11&quot;, &quot;B11&quot;, &quot;C10&quot;, &quot;E20…
## $ LU       &lt;chr&gt; &quot;U111&quot;, &quot;U111&quot;, &quot;U111&quot;, &quot;U120&quot;, …
## $ NUTS_0   &lt;chr&gt; &quot;DE&quot;, &quot;DE&quot;, &quot;DE&quot;, &quot;DE&quot;, &quot;DE&quot;, &quot;D…
## $ NUTS_1   &lt;chr&gt; &quot;DED&quot;, &quot;DED&quot;, &quot;DED&quot;, &quot;DED&quot;, &quot;DED…
## $ NUTS_2   &lt;chr&gt; &quot;DED4&quot;, &quot;DED5&quot;, &quot;DED5&quot;, &quot;DED5&quot;, …
## $ NUTS_3   &lt;chr&gt; &quot;DED44&quot;, &quot;DED52&quot;, &quot;DED53&quot;, &quot;DED5…
## $ LC0_Desc &lt;chr&gt; &quot;Grassland&quot;, &quot;Cropland&quot;, &quot;Cropla…
## $ LC1_Desc &lt;chr&gt; &quot;Grassland with sparse tree/shru…
## $ LU1_Desc &lt;chr&gt; &quot;Agriculture (excluding fallow l…
## $ geometry &lt;POINT [°]&gt; POINT (12.15614 50.48765),…</code></pre>
<p>We use the <code>tmap</code> package to display the data on a map.
Note that interactive maps are generally better to explore your data.
For the sake of stability, I have stuck to static maps for this book.
To turn all your subsequent tmaps interactive use <code>tmap_mode("view")</code>.</p>
<div class="sourceCode" id="cb269"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb269-1"><a href="interpolation.html#cb269-1" tabindex="-1"></a><span class="fu">tm_shape</span>(lucas) <span class="sc">+</span> <span class="fu">tm_dots</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-164-1.png" width="672" /></p>
<p><br/></p>
<p>For later maps, we need the boundaries of the German federal state Saxony.
We get it from the Database of Global Administrative Areas (GADM), which we have used these data for Germany before (<code>gadm36_DEU_3_pk.gpkg</code>).
You can download them <a href="https://seafile.rlp.net/d/c757bff20f1f49f99cb2/">here</a>.
You can always query other countries or resolutions by following <a href="https://jonjup.netlify.app/post/the-geodata-package/">this tutorial</a>.</p>
<div class="sourceCode" id="cb270"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb270-1"><a href="interpolation.html#cb270-1" tabindex="-1"></a>saxony <span class="ot">&lt;-</span> </span>
<span id="cb270-2"><a href="interpolation.html#cb270-2" tabindex="-1"></a>        <span class="fu">st_read</span>(<span class="st">&quot;data/gadm36_DEU_3_pk.gpkg&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb270-3"><a href="interpolation.html#cb270-3" tabindex="-1"></a>        <span class="fu">st_as_sf</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb270-4"><a href="interpolation.html#cb270-4" tabindex="-1"></a>        <span class="fu">filter</span>(NAME_1 <span class="sc">==</span> <span class="st">&quot;Sachsen&quot;</span>)</span></code></pre></div>
<pre><code>## Reading layer `gadm36_DEU_3_pk&#39; from data source 
##   `C:\Users\jonat\Documents\001_Uni\002_teaching\online books\book_spatial_data_science_in_R\data\gadm36_DEU_3_pk.gpkg&#39; 
##   using driver `GPKG&#39;
## Simple feature collection with 4680 features and 16 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: 5.866251 ymin: 47.27012 xmax: 15.04181 ymax: 55.05653
## Geodetic CRS:  WGS 84</code></pre>
<div class="sourceCode" id="cb272"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb272-1"><a href="interpolation.html#cb272-1" tabindex="-1"></a><span class="fu">tm_shape</span>(saxony) <span class="sc">+</span> <span class="fu">tm_polygons</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-166-1.png" width="672" />
<br/></p>
</div>
<div id="proximity-polygons" class="section level2 hasAnchor" number="4.2">
<h2><span class="header-section-number">4.2</span> Proximity Polygons<a href="interpolation.html#proximity-polygons" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Let’s begin with proximity polygons, also known as <em>Voronoi polygons</em>. These are perhaps the simplest way to fill space between our points. Creating them in R is straightforward - we just use the <code>st_voronoi()</code> function. Think of it like drawing boundaries where each polygon contains all areas that are closest to its central point. If you’ve ever seen a map showing school districts, you’ve probably seen Voronoi polygons in action!</p>
<div class="sourceCode" id="cb273"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb273-1"><a href="interpolation.html#cb273-1" tabindex="-1"></a><span class="co">#- st_voroni works better with projected coordinate reference systems </span></span>
<span id="cb273-2"><a href="interpolation.html#cb273-2" tabindex="-1"></a>voroni <span class="ot">&lt;-</span> <span class="fu">st_voronoi</span>(lucas)</span></code></pre></div>
<pre><code>## Warning in st_voronoi.sfc(st_geometry(x),
## st_sfc(envelope), dTolerance, : st_voronoi does
## not correctly triangulate longitude/latitude data</code></pre>
<p>When we run this code, we’ll get a warning message telling us that we should use projected coordinates for better accuracy. That’s why we’ll transform our data from the WGS84 coordinate system (which uses latitude and longitude) to the [Lambert Azimuthal Equal Area](<a href="https://pro.arcgis.com/en/pro-app/latest/help/mapping/properties/lambert-azimuthal-equal-area.htm#" class="uri">https://pro.arcgis.com/en/pro-app/latest/help/mapping/properties/lambert-azimuthal-equal-area.htm#</a>:~:text=Lambert%20azimuthal%20equal%2Darea%20is%20an%20equal%2Darea%20(equivalent,the%20center%20of%20the%20projection.) projection.</p>
<div class="sourceCode" id="cb275"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb275-1"><a href="interpolation.html#cb275-1" tabindex="-1"></a>lucas   <span class="sc">%&lt;&gt;%</span> <span class="fu">st_transform</span>(<span class="dv">3035</span>)</span>
<span id="cb275-2"><a href="interpolation.html#cb275-2" tabindex="-1"></a>saxony <span class="sc">%&lt;&gt;%</span> <span class="fu">st_transform</span>(<span class="dv">3035</span>)</span></code></pre></div>
<p>With the following code we’ll create Voronoi polygons around our sampling points in lucas and then trim them to match the boundary of Saxony.
This requires a few steps:
1. First, we used <code>st_union()</code> to combine all the individual points in <code>lucas</code> into a single MULTIPOINT object.<br />
2. Next, <code>st_voronoi()</code> creates the Voronoi polygons around these points, giving us a GEOMETRYCOLLECTION.<br />
3. Finally, we use st_collection_extract() to pull out just the polygons we want from this collection.<br />
Tip: Try running these commands one at a time and examine what each step produces. It’s a great way to understand how each function transforms your data!</p>
<div class="sourceCode" id="cb276"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb276-1"><a href="interpolation.html#cb276-1" tabindex="-1"></a>voroni <span class="ot">&lt;-</span> </span>
<span id="cb276-2"><a href="interpolation.html#cb276-2" tabindex="-1"></a>        lucas <span class="sc">%&gt;%</span></span>
<span id="cb276-3"><a href="interpolation.html#cb276-3" tabindex="-1"></a>        <span class="fu">st_union</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb276-4"><a href="interpolation.html#cb276-4" tabindex="-1"></a>        <span class="fu">st_voronoi</span>() <span class="sc">%&gt;%</span></span>
<span id="cb276-5"><a href="interpolation.html#cb276-5" tabindex="-1"></a>        <span class="fu">st_collection_extract</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb276-6"><a href="interpolation.html#cb276-6" tabindex="-1"></a>        <span class="fu">st_intersection</span>(<span class="at">y=</span> saxony) <span class="sc">%&gt;%</span></span>
<span id="cb276-7"><a href="interpolation.html#cb276-7" tabindex="-1"></a>        <span class="fu">st_as_sf</span>()</span></code></pre></div>
<p>Next, we’ll add the electrical conductivity (EC) values to each polygon. Think of EC as our example variable - it’s just the data we want to map across our area. We match each polygon with its closest measurement point using the <code>st_nearest_feature()</code> function, which essentially says “take this polygon and find the sampling point that belongs to it.”</p>
<div class="sourceCode" id="cb277"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb277-1"><a href="interpolation.html#cb277-1" tabindex="-1"></a>id <span class="ot">&lt;-</span> <span class="fu">st_nearest_feature</span>(voroni, lucas)</span>
<span id="cb277-2"><a href="interpolation.html#cb277-2" tabindex="-1"></a>voroni<span class="sc">$</span>EC <span class="ot">&lt;-</span> lucas<span class="sc">$</span>EC[id]</span></code></pre></div>
<p>Now we have the final product also shown in the lecture:</p>
<div class="sourceCode" id="cb278"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb278-1"><a href="interpolation.html#cb278-1" tabindex="-1"></a><span class="fu">tm_shape</span>(voroni) <span class="sc">+</span> </span>
<span id="cb278-2"><a href="interpolation.html#cb278-2" tabindex="-1"></a>        <span class="fu">tm_polygons</span>(<span class="at">col =</span> <span class="st">&quot;EC&quot;</span>) <span class="sc">+</span> </span>
<span id="cb278-3"><a href="interpolation.html#cb278-3" tabindex="-1"></a>        <span class="fu">tm_shape</span>(lucas) <span class="sc">+</span> </span>
<span id="cb278-4"><a href="interpolation.html#cb278-4" tabindex="-1"></a>        <span class="fu">tm_dots</span>(<span class="at">col =</span> <span class="st">&quot;EC&quot;</span>, <span class="at">size =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-171-1.png" width="672" />
<br/></p>
<div class="blackbox">
<div class="center">
<p><strong>Exercise</strong></p>
</div>
<p>Create proximity polygons for the variable Phosphorus</p>
</div>
<p><br/></p>
</div>
<div id="trend-surface-analysis" class="section level2 hasAnchor" number="4.3">
<h2><span class="header-section-number">4.3</span> Trend Surface Analysis<a href="interpolation.html#trend-surface-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Trend surface analysis (TSA) helps us understand how our measurements (in this case, EC) change across space. It’s just a regular regression analysis where we use location coordinates to explain these changes. Think of it as fitting a mathematical surface over our study area!
We’ll use R’s standard regression function <code>lm()</code> for this. First though, we need to get the X and Y coordinates of our sampling points from the lucas dataset using the <code>st_coordinates()</code> function.</p>
<div class="sourceCode" id="cb279"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb279-1"><a href="interpolation.html#cb279-1" tabindex="-1"></a>coords  <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(lucas)</span>
<span id="cb279-2"><a href="interpolation.html#cb279-2" tabindex="-1"></a>x.coord <span class="ot">&lt;-</span> coords[,<span class="dv">1</span>]</span>
<span id="cb279-3"><a href="interpolation.html#cb279-3" tabindex="-1"></a>y.coord <span class="ot">&lt;-</span> coords[,<span class="dv">2</span>]</span>
<span id="cb279-4"><a href="interpolation.html#cb279-4" tabindex="-1"></a>lucas <span class="ot">&lt;-</span> <span class="fu">mutate</span>(lucas, </span>
<span id="cb279-5"><a href="interpolation.html#cb279-5" tabindex="-1"></a>                <span class="at">x =</span> x.coord, </span>
<span id="cb279-6"><a href="interpolation.html#cb279-6" tabindex="-1"></a>                <span class="at">y =</span> y.coord</span>
<span id="cb279-7"><a href="interpolation.html#cb279-7" tabindex="-1"></a>                )</span></code></pre></div>
<p>Now we’ll try two types of regression models to see which better fits our data:</p>
<ol style="list-style-type: decimal">
<li>A simple linear regression (which will give us a tilted plane)<br />
</li>
<li>A polynomial regression of second degree (which can capture more complex curves and valleys in our data)</li>
</ol>
<p>Don’t worry if you’re not familiar with polynomial regression - just think of it as allowing our surface to bend and curve instead of staying flat! While a simple linear regression has the equation <span class="math inline">\(y_i = \alpha + \beta x_i + \epsilon_i\)</span> a polynomial regression adds the quadrat of same predictor: <span class="math inline">\(y_i = \alpha + \beta_1 x_{i} + \beta_{2}x_i^2 + \epsilon_i\)</span>. Here <span class="math inline">\(i\)</span> is just the index for the sampling site.</p>
<div class="sourceCode" id="cb280"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb280-1"><a href="interpolation.html#cb280-1" tabindex="-1"></a>tsa1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(EC <span class="sc">~</span> x<span class="sc">+</span>y, <span class="at">data =</span> lucas)</span>
<span id="cb280-2"><a href="interpolation.html#cb280-2" tabindex="-1"></a>tsa2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(EC <span class="sc">~</span> <span class="fu">polym</span>(x, y, <span class="at">degree=</span><span class="dv">2</span>), <span class="at">data =</span> lucas)</span></code></pre></div>
<p>Now comes the fun part - using our model to predict values at locations where we don’t have measurements! We’ll try this in two ways:</p>
<p>1.By creating random points scattered across Saxony (like throwing confetti over a map)<br />
2.By creating a regular grid of points (like laying a checkerboard pattern over Saxony)</p>
<p>Each approach has its uses - random points might help us understand the overall pattern, while a regular grid is great for making smooth maps.</p>
<p>We’ll create random points using the <code>st_sample()</code> function. It needs two main things:
1. The area where points can be placed (in our case, Saxony)<br />
2. How many points we want (we’ll create 300)</p>
<p>That’s all it takes to distribute 300 random points across our study area!</p>
<div class="sourceCode" id="cb281"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb281-1"><a href="interpolation.html#cb281-1" tabindex="-1"></a>random_points <span class="ot">&lt;-</span> <span class="fu">st_sample</span>(saxony, <span class="dv">300</span>)</span>
<span id="cb281-2"><a href="interpolation.html#cb281-2" tabindex="-1"></a><span class="fu">tm_shape</span>(random_points) <span class="sc">+</span> <span class="fu">tm_dots</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-174-1.png" width="672" />
<br/></p>
<p>Before we can add our predicted values, we need to do some data formatting: Our <code>random_points</code> object is currently just a geometry column (class <code>sfc</code>, <em>simple feature column</em>). To add more data to it, we need to convert it to a proper spatial data.frame using <code>st_as_sf()</code>. During this conversion, our geometry column gets named “x” - not very informative! We’ll use the dplyr package’s <code>rename()</code> function to give it the more conventional name “geometry”. Lastly, we extract coordinates of the random points using <code>st_coordinates()</code>. These are directly added back to <code>random_points</code> with the <code>mutate</code> function from dplyr. This functions adds new variables to data sets.</p>
<div class="sourceCode" id="cb282"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb282-1"><a href="interpolation.html#cb282-1" tabindex="-1"></a>random_points <span class="ot">&lt;-</span> </span>
<span id="cb282-2"><a href="interpolation.html#cb282-2" tabindex="-1"></a>        random_points <span class="sc">%&gt;%</span> </span>
<span id="cb282-3"><a href="interpolation.html#cb282-3" tabindex="-1"></a>        <span class="fu">st_as_sf</span>() <span class="sc">%&gt;%</span></span>
<span id="cb282-4"><a href="interpolation.html#cb282-4" tabindex="-1"></a>        <span class="fu">rename</span>(<span class="at">geom =</span> x) <span class="sc">%&gt;%</span> </span>
<span id="cb282-5"><a href="interpolation.html#cb282-5" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">x =</span> <span class="fu">st_coordinates</span>(random_points)[,<span class="dv">1</span>], </span>
<span id="cb282-6"><a href="interpolation.html#cb282-6" tabindex="-1"></a>               <span class="at">y =</span> <span class="fu">st_coordinates</span>(random_points)[,<span class="dv">2</span>])</span></code></pre></div>
<p>We predict the EC for these coordinates with <code>predict()</code>. <code>Predict()</code> takes two arguments: 1. A model used to make the prediction (<code>tsa1</code> and <code>tsa2</code>); 2. new values for the dependent/ predictor variables. In our case, the new predictor values are the spatial coordinates of the points.</p>
<div class="sourceCode" id="cb283"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb283-1"><a href="interpolation.html#cb283-1" tabindex="-1"></a>random_points<span class="sc">$</span>EC_tsa1 <span class="ot">&lt;-</span> <span class="fu">predict</span>(tsa1, random_points)</span>
<span id="cb283-2"><a href="interpolation.html#cb283-2" tabindex="-1"></a>random_points<span class="sc">$</span>EC_tsa2 <span class="ot">&lt;-</span> <span class="fu">predict</span>(tsa2, random_points)</span></code></pre></div>
<p>Let’s have a look at the results.
On the following map circles are true observations and diamonds are predicted values.</p>
<div class="sourceCode" id="cb284"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb284-1"><a href="interpolation.html#cb284-1" tabindex="-1"></a>breaks <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">10</span>, <span class="dv">15</span>,<span class="dv">20</span>, <span class="dv">25</span>, <span class="dv">30</span>, <span class="dv">35</span>, <span class="dv">40</span>, <span class="dv">170</span>)</span>
<span id="cb284-2"><a href="interpolation.html#cb284-2" tabindex="-1"></a></span>
<span id="cb284-3"><a href="interpolation.html#cb284-3" tabindex="-1"></a><span class="fu">tm_shape</span>(saxony) <span class="sc">+</span> </span>
<span id="cb284-4"><a href="interpolation.html#cb284-4" tabindex="-1"></a>        <span class="fu">tm_polygons</span>() <span class="sc">+</span> </span>
<span id="cb284-5"><a href="interpolation.html#cb284-5" tabindex="-1"></a>        <span class="fu">tm_shape</span>(random_points) <span class="sc">+</span> </span>
<span id="cb284-6"><a href="interpolation.html#cb284-6" tabindex="-1"></a>        <span class="fu">tm_dots</span>(<span class="at">col =</span> <span class="st">&quot;EC_tsa1&quot;</span>, <span class="at">shape =</span> <span class="dv">23</span>, <span class="at">size =</span> .<span class="dv">5</span>, <span class="at">breaks =</span> breaks) <span class="sc">+</span> </span>
<span id="cb284-7"><a href="interpolation.html#cb284-7" tabindex="-1"></a>        <span class="fu">tm_shape</span>(lucas) <span class="sc">+</span> </span>
<span id="cb284-8"><a href="interpolation.html#cb284-8" tabindex="-1"></a>        <span class="fu">tm_dots</span>(<span class="at">col =</span> <span class="st">&quot;EC&quot;</span>, <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> .<span class="dv">5</span>, <span class="at">breaks =</span> breaks) <span class="sc">+</span> </span>
<span id="cb284-9"><a href="interpolation.html#cb284-9" tabindex="-1"></a>        <span class="fu">tm_layout</span>(<span class="at">legend.outside =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-177-1.png" width="672" /></p>
<div class="sourceCode" id="cb285"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb285-1"><a href="interpolation.html#cb285-1" tabindex="-1"></a><span class="fu">tm_shape</span>(saxony) <span class="sc">+</span></span>
<span id="cb285-2"><a href="interpolation.html#cb285-2" tabindex="-1"></a>        <span class="fu">tm_polygons</span>() <span class="sc">+</span> </span>
<span id="cb285-3"><a href="interpolation.html#cb285-3" tabindex="-1"></a>        <span class="fu">tm_shape</span>(random_points) <span class="sc">+</span> </span>
<span id="cb285-4"><a href="interpolation.html#cb285-4" tabindex="-1"></a>        <span class="fu">tm_dots</span>(<span class="at">col =</span> <span class="st">&quot;EC_tsa2&quot;</span>, <span class="at">shape =</span> <span class="dv">23</span>, <span class="at">size =</span> .<span class="dv">5</span>, <span class="at">breaks =</span> breaks, <span class="at">midpoint =</span> <span class="cn">NA</span>) <span class="sc">+</span> </span>
<span id="cb285-5"><a href="interpolation.html#cb285-5" tabindex="-1"></a>        <span class="fu">tm_layout</span>(<span class="at">legend.outside =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> </span>
<span id="cb285-6"><a href="interpolation.html#cb285-6" tabindex="-1"></a>        <span class="fu">tm_shape</span>(lucas) <span class="sc">+</span> </span>
<span id="cb285-7"><a href="interpolation.html#cb285-7" tabindex="-1"></a>         <span class="fu">tm_dots</span>(<span class="at">col =</span> <span class="st">&quot;EC&quot;</span>, <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> .<span class="dv">5</span>, <span class="at">breaks =</span> breaks) </span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-177-2.png" width="672" />
<br/></p>
<div class="blackbox">
<div class="center">
<p><strong>Exercise</strong></p>
</div>
<p>Predict phosphorus concentrations at 150 random locations in Saxony with a non-polynomial trend surface analysis.</p>
</div>
<p><br/></p>
<p>Now let’s create a grid of regularly spaced points. First, we need to find the rectangular box that completely contains Saxony. Think of it like drawing the smallest possible rectangle around Saxony’s shape - we can get this bounding box using the <code>st_bbox()</code> function.</p>
<div class="sourceCode" id="cb286"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb286-1"><a href="interpolation.html#cb286-1" tabindex="-1"></a>saxony_bbox <span class="ot">&lt;-</span> <span class="fu">st_bbox</span>(saxony)</span>
<span id="cb286-2"><a href="interpolation.html#cb286-2" tabindex="-1"></a>saxony_bbox</span></code></pre></div>
<pre><code>##    xmin    ymin    xmax    ymax 
## 4453658 3009238 4672526 3178781</code></pre>
<p>With <code>st_as_sfc()</code> we can create a polygon from the bounding box.</p>
<div class="sourceCode" id="cb288"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb288-1"><a href="interpolation.html#cb288-1" tabindex="-1"></a>saxony_bbox_sfc <span class="ot">&lt;-</span> <span class="fu">st_as_sfc</span>(saxony_bbox)</span>
<span id="cb288-2"><a href="interpolation.html#cb288-2" tabindex="-1"></a><span class="fu">tm_shape</span>(saxony_bbox_sfc) <span class="sc">+</span> <span class="fu">tm_borders</span>() <span class="sc">+</span> <span class="fu">tm_shape</span>(saxony) <span class="sc">+</span> <span class="fu">tm_polygons</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-179-1.png" width="672" />
<br/></p>
<p>Now we’ll create a regular grid using <code>st_make_grid()</code>. Since our coordinate system is in meters (LAEA projection), we can directly specify the grid size in real-world units. We’ll make square cells that are 10 kilometers on each side. Think of it like laying a giant checkerboard over Saxony, where each square is 10 km × 10 km.</p>
<div class="sourceCode" id="cb289"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb289-1"><a href="interpolation.html#cb289-1" tabindex="-1"></a>saxony_grid <span class="ot">&lt;-</span> <span class="fu">st_make_grid</span>(</span>
<span id="cb289-2"><a href="interpolation.html#cb289-2" tabindex="-1"></a>        <span class="at">x =</span> saxony_bbox_sfc, </span>
<span id="cb289-3"><a href="interpolation.html#cb289-3" tabindex="-1"></a>        <span class="at">cellsize =</span> <span class="fu">c</span>(<span class="fl">1e4</span>,<span class="fl">1e4</span>),</span>
<span id="cb289-4"><a href="interpolation.html#cb289-4" tabindex="-1"></a>        <span class="at">what =</span> <span class="st">&quot;polygons&quot;</span></span>
<span id="cb289-5"><a href="interpolation.html#cb289-5" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb289-6"><a href="interpolation.html#cb289-6" tabindex="-1"></a>        <span class="fu">st_as_sf</span>()</span>
<span id="cb289-7"><a href="interpolation.html#cb289-7" tabindex="-1"></a></span>
<span id="cb289-8"><a href="interpolation.html#cb289-8" tabindex="-1"></a><span class="fu">tm_shape</span>(saxony_grid) <span class="sc">+</span> <span class="fu">tm_borders</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-180-1.png" width="672" />
<br/></p>
<p>Now we need to crop the grid to Saxony.</p>
<div class="sourceCode" id="cb290"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb290-1"><a href="interpolation.html#cb290-1" tabindex="-1"></a>saxony_grid <span class="sc">%&lt;&gt;%</span> <span class="fu">st_intersection</span>(<span class="fu">st_union</span>(saxony))</span>
<span id="cb290-2"><a href="interpolation.html#cb290-2" tabindex="-1"></a><span class="fu">tm_shape</span>(saxony_grid) <span class="sc">+</span> <span class="fu">tm_borders</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-181-1.png" width="672" />
<br/></p>
<p>Great! But we have a small challenge: our grid gives us squares (polygons), but we need single points for our predictions. Each square has four corners and a center point, and we need to choose which points to use. Fortunately, <code>st_make_grid()</code> can give us either: the corner points of each grid cell or the center points (centroids) of each cell.
Both options work well.</p>
<div class="sourceCode" id="cb291"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb291-1"><a href="interpolation.html#cb291-1" tabindex="-1"></a>saxony_grid_corner <span class="ot">&lt;-</span> </span>
<span id="cb291-2"><a href="interpolation.html#cb291-2" tabindex="-1"></a>        <span class="fu">st_make_grid</span>(</span>
<span id="cb291-3"><a href="interpolation.html#cb291-3" tabindex="-1"></a>                <span class="at">x =</span> saxony_bbox_sfc, </span>
<span id="cb291-4"><a href="interpolation.html#cb291-4" tabindex="-1"></a>                <span class="at">cellsize =</span> <span class="fu">c</span>(<span class="fl">1e4</span>,<span class="fl">1e4</span>),</span>
<span id="cb291-5"><a href="interpolation.html#cb291-5" tabindex="-1"></a>                <span class="at">what =</span> <span class="st">&quot;corners&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb291-6"><a href="interpolation.html#cb291-6" tabindex="-1"></a>        <span class="fu">st_as_sf</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb291-7"><a href="interpolation.html#cb291-7" tabindex="-1"></a>        <span class="fu">st_intersection</span>(saxony)</span></code></pre></div>
<pre><code>## Warning: attribute variables are assumed to be
## spatially constant throughout all geometries</code></pre>
<div class="sourceCode" id="cb293"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb293-1"><a href="interpolation.html#cb293-1" tabindex="-1"></a><span class="fu">tm_shape</span>(saxony_grid) <span class="sc">+</span> <span class="fu">tm_borders</span>() <span class="sc">+</span> </span>
<span id="cb293-2"><a href="interpolation.html#cb293-2" tabindex="-1"></a>        <span class="fu">tm_shape</span>(saxony_grid_corner) <span class="sc">+</span> <span class="fu">tm_dots</span>(<span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">size =</span> .<span class="dv">6</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-182-1.png" width="672" /></p>
<div class="sourceCode" id="cb294"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb294-1"><a href="interpolation.html#cb294-1" tabindex="-1"></a>saxony_grid_centroid <span class="ot">&lt;-</span> </span>
<span id="cb294-2"><a href="interpolation.html#cb294-2" tabindex="-1"></a>        <span class="fu">st_make_grid</span>(</span>
<span id="cb294-3"><a href="interpolation.html#cb294-3" tabindex="-1"></a>        <span class="at">x =</span> saxony_bbox_sfc, </span>
<span id="cb294-4"><a href="interpolation.html#cb294-4" tabindex="-1"></a>        <span class="at">cellsize =</span> <span class="fu">c</span>(<span class="fl">1e4</span>,<span class="fl">1e4</span>),</span>
<span id="cb294-5"><a href="interpolation.html#cb294-5" tabindex="-1"></a>        <span class="at">what =</span> <span class="st">&quot;centers&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb294-6"><a href="interpolation.html#cb294-6" tabindex="-1"></a>        <span class="fu">st_as_sf</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb294-7"><a href="interpolation.html#cb294-7" tabindex="-1"></a>        <span class="fu">st_intersection</span>(saxony)</span></code></pre></div>
<pre><code>## Warning: attribute variables are assumed to be
## spatially constant throughout all geometries</code></pre>
<div class="sourceCode" id="cb296"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb296-1"><a href="interpolation.html#cb296-1" tabindex="-1"></a><span class="fu">tm_shape</span>(saxony_grid) <span class="sc">+</span> <span class="fu">tm_borders</span>() <span class="sc">+</span> <span class="fu">tm_shape</span>(saxony_grid_centroid) <span class="sc">+</span> <span class="fu">tm_dots</span>(<span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">size =</span> .<span class="dv">6</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-183-1.png" width="672" /></p>
<p><br/></p>
<p>We could also have extracted the centroids from the polygons with the following code:</p>
<div class="sourceCode" id="cb297"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb297-1"><a href="interpolation.html#cb297-1" tabindex="-1"></a>saxony_grid_centroid <span class="ot">&lt;-</span> </span>
<span id="cb297-2"><a href="interpolation.html#cb297-2" tabindex="-1"></a>        saxony_grid <span class="sc">%&gt;%</span> </span>
<span id="cb297-3"><a href="interpolation.html#cb297-3" tabindex="-1"></a>        <span class="fu">st_centroid</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb297-4"><a href="interpolation.html#cb297-4" tabindex="-1"></a>        <span class="fu">st_as_sf</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb297-5"><a href="interpolation.html#cb297-5" tabindex="-1"></a>        <span class="fu">rename</span>(<span class="at">geom =</span> x)</span></code></pre></div>
<p>Now comes the satisfying part: we’ll predict values for each grid center point, and then map these values back to their grid squares for visualization. Think of it like filling in each square of our checkerboard with a color that represents our predicted EC value! Note that this is like a combination of proximity polygons and trend surface analysis. TSA predicts the values at each (point) location which is then interpolated to the grid. With regularly spaced points, the proximity polygons are a regular grid.</p>
<div class="sourceCode" id="cb298"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb298-1"><a href="interpolation.html#cb298-1" tabindex="-1"></a>saxony_grid_centroid <span class="sc">%&lt;&gt;%</span> </span>
<span id="cb298-2"><a href="interpolation.html#cb298-2" tabindex="-1"></a>        <span class="fu">mutate</span>(</span>
<span id="cb298-3"><a href="interpolation.html#cb298-3" tabindex="-1"></a>                <span class="at">x =</span> <span class="fu">st_coordinates</span>(saxony_grid_centroid)[,<span class="dv">1</span>], </span>
<span id="cb298-4"><a href="interpolation.html#cb298-4" tabindex="-1"></a>                <span class="at">y =</span> <span class="fu">st_coordinates</span>(saxony_grid_centroid)[,<span class="dv">2</span>]</span>
<span id="cb298-5"><a href="interpolation.html#cb298-5" tabindex="-1"></a>        )</span>
<span id="cb298-6"><a href="interpolation.html#cb298-6" tabindex="-1"></a></span>
<span id="cb298-7"><a href="interpolation.html#cb298-7" tabindex="-1"></a>saxony_grid_centroid<span class="sc">$</span>EC_tsa_1 <span class="ot">&lt;-</span> <span class="fu">predict</span>(tsa1, saxony_grid_centroid)</span>
<span id="cb298-8"><a href="interpolation.html#cb298-8" tabindex="-1"></a>saxony_grid_centroid<span class="sc">$</span>EC_tsa_2 <span class="ot">&lt;-</span> <span class="fu">predict</span>(tsa2, saxony_grid_centroid)</span>
<span id="cb298-9"><a href="interpolation.html#cb298-9" tabindex="-1"></a></span>
<span id="cb298-10"><a href="interpolation.html#cb298-10" tabindex="-1"></a>saxony_grid<span class="sc">$</span>EC_tsa1 <span class="ot">&lt;-</span> saxony_grid_centroid<span class="sc">$</span>EC_tsa_1</span>
<span id="cb298-11"><a href="interpolation.html#cb298-11" tabindex="-1"></a>saxony_grid<span class="sc">$</span>EC_tsa2 <span class="ot">&lt;-</span> saxony_grid_centroid<span class="sc">$</span>EC_tsa_2</span>
<span id="cb298-12"><a href="interpolation.html#cb298-12" tabindex="-1"></a></span>
<span id="cb298-13"><a href="interpolation.html#cb298-13" tabindex="-1"></a><span class="fu">tm_shape</span>(saxony_grid) <span class="sc">+</span> <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">&quot;EC_tsa1&quot;</span>) <span class="sc">+</span> </span>
<span id="cb298-14"><a href="interpolation.html#cb298-14" tabindex="-1"></a>        <span class="fu">tm_shape</span>(lucas) <span class="sc">+</span> <span class="fu">tm_dots</span>(<span class="at">col =</span> <span class="st">&quot;EC&quot;</span>, <span class="at">size =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-185-1.png" width="672" /></p>
<div class="sourceCode" id="cb299"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb299-1"><a href="interpolation.html#cb299-1" tabindex="-1"></a><span class="fu">tm_shape</span>(saxony_grid) <span class="sc">+</span> <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">&quot;EC_tsa2&quot;</span>) <span class="sc">+</span> </span>
<span id="cb299-2"><a href="interpolation.html#cb299-2" tabindex="-1"></a>        <span class="fu">tm_shape</span>(lucas) <span class="sc">+</span> <span class="fu">tm_dots</span>(<span class="at">col =</span> <span class="st">&quot;EC&quot;</span>, <span class="at">size =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-185-2.png" width="672" />
<br/></p>
</div>
<div id="splines" class="section level2 hasAnchor" number="4.4">
<h2><span class="header-section-number">4.4</span> Splines<a href="interpolation.html#splines" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Let’s explore another interpolation method: splines! We’ll use a special type called thin plate splines, which you can think of as trying to bend a flexible surface to fit through all our measurement points. We’ll use the <code>Tps()</code> function from the <code>fields</code> package - all it needs are our point coordinates and our EC values to work its magic.</p>
<div class="sourceCode" id="cb300"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb300-1"><a href="interpolation.html#cb300-1" tabindex="-1"></a>tps_fit <span class="ot">&lt;-</span> <span class="fu">Tps</span>(<span class="at">x =</span> <span class="fu">matrix</span>(<span class="fu">c</span>(lucas<span class="sc">$</span>x, lucas<span class="sc">$</span>y), <span class="at">ncol =</span> <span class="dv">2</span>), <span class="at">Y =</span> lucas<span class="sc">$</span>EC)</span></code></pre></div>
<p>Just like before, we’ll use the <code>predict()</code> function to estimate EC values at our grid points. The function gives us a matrix of predictions, which we’ll convert into a simple vector of numbers using <code>as.numeric()</code>.</p>
<div class="sourceCode" id="cb301"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb301-1"><a href="interpolation.html#cb301-1" tabindex="-1"></a>tps_prediction <span class="ot">&lt;-</span> <span class="fu">predict</span>(tps_fit, <span class="fu">st_drop_geometry</span>(saxony_grid_centroid[, <span class="fu">c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;y&quot;</span>)]))</span>
<span id="cb301-2"><a href="interpolation.html#cb301-2" tabindex="-1"></a>saxony_grid<span class="sc">$</span>EC_tps <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(tps_prediction)</span></code></pre></div>
<div class="sourceCode" id="cb302"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb302-1"><a href="interpolation.html#cb302-1" tabindex="-1"></a><span class="fu">tm_shape</span>(saxony_grid) <span class="sc">+</span> <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">&quot;EC_tps&quot;</span>) <span class="sc">+</span> </span>
<span id="cb302-2"><a href="interpolation.html#cb302-2" tabindex="-1"></a>        <span class="fu">tm_shape</span>(lucas) <span class="sc">+</span> <span class="fu">tm_dots</span>(<span class="at">col =</span> <span class="st">&quot;EC&quot;</span>, <span class="at">size =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-188-1.png" width="672" />
<br/></p>
<div class="blackbox">
<div class="center">
<p><strong>Exercise</strong></p>
</div>
<p>Fit a thin plate spline to the phosphorus data</p>
</div>
<p><br/></p>
</div>
<div id="weighted-averaging" class="section level2 hasAnchor" number="4.5">
<h2><span class="header-section-number">4.5</span> Weighted averaging<a href="interpolation.html#weighted-averaging" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Now let’s explore methods that consider how far points are from each other. We’ll start with a simple one called <em>k nearest neighbors</em> (kNN).
Imagine you want to guess the EC value at a new location:</p>
<ol style="list-style-type: decimal">
<li>kNN finds the <span class="math inline">\(k\)</span> closest measurement points to your location<br />
</li>
<li>It then simply takes their average to make a prediction<br />
</li>
<li>Only these <span class="math inline">\(k\)</span> nearest points matter - all other points are ignored, no matter how close or far they are</li>
</ol>
<p>We’ll use the <code>gstat</code> package for this and all our other weighted averaging methods. Here’s how we set it up:</p>
<ul>
<li>We create a model using the <code>gstat()</code> function<br />
</li>
<li>Use <code>-1</code> in the formula to say “just find the mean value, I don’t care about the intercept”<br />
</li>
<li>Set <code>locations</code> to tell it where our points are<br />
</li>
<li>Use <code>nmax</code> to specify <span class="math inline">\(K\)</span> (how many neighbors to consider)<br />
</li>
<li>Set <code>idp</code> (inverse distance parameter) to control distance weighting</li>
</ul>
<p>For our example, we’ll use the 5 nearest neighbors (<code>nmax = 5</code>) and give them all equal weight (<code>idp = 0</code>, meaning distance doesn’t affect the weights).</p>
<div class="sourceCode" id="cb303"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb303-1"><a href="interpolation.html#cb303-1" tabindex="-1"></a>knn_mod <span class="ot">&lt;-</span> <span class="fu">gstat</span>(<span class="at">formula=</span>EC<span class="sc">~</span><span class="dv">1</span>, </span>
<span id="cb303-2"><a href="interpolation.html#cb303-2" tabindex="-1"></a>                 <span class="at">locations=</span>lucas, </span>
<span id="cb303-3"><a href="interpolation.html#cb303-3" tabindex="-1"></a>                 <span class="at">nmax=</span><span class="dv">5</span>, </span>
<span id="cb303-4"><a href="interpolation.html#cb303-4" tabindex="-1"></a>                 <span class="at">set=</span><span class="fu">list</span>(<span class="at">idp =</span> <span class="dv">0</span>))</span>
<span id="cb303-5"><a href="interpolation.html#cb303-5" tabindex="-1"></a>knn_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(knn_mod, saxony_grid)</span></code></pre></div>
<pre><code>## [inverse distance weighted interpolation]</code></pre>
<div class="sourceCode" id="cb305"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb305-1"><a href="interpolation.html#cb305-1" tabindex="-1"></a><span class="fu">tm_shape</span>(knn_pred) <span class="sc">+</span> <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">&quot;var1.pred&quot;</span>) <span class="sc">+</span> </span>
<span id="cb305-2"><a href="interpolation.html#cb305-2" tabindex="-1"></a>        <span class="fu">tm_shape</span>(lucas) <span class="sc">+</span> <span class="fu">tm_dots</span>(<span class="at">col =</span> <span class="st">&quot;EC&quot;</span>, <span class="at">size =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-190-1.png" width="672" />
<br/></p>
<p>For inverse distance weighting (IDW) the model construction and prediction are packaged into a single function (<code>idw</code>).</p>
<div class="sourceCode" id="cb306"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb306-1"><a href="interpolation.html#cb306-1" tabindex="-1"></a>idw1 <span class="ot">&lt;-</span> <span class="fu">idw</span>(EC <span class="sc">~</span> <span class="dv">1</span>, <span class="at">locations =</span> lucas, <span class="at">newdata =</span> saxony_grid_centroid, <span class="at">idp =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [inverse distance weighted interpolation]</code></pre>
<div class="sourceCode" id="cb308"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb308-1"><a href="interpolation.html#cb308-1" tabindex="-1"></a>idw2 <span class="ot">&lt;-</span> <span class="fu">idw</span>(EC <span class="sc">~</span> <span class="dv">1</span>, <span class="at">locations =</span> lucas, <span class="at">newdata =</span> saxony_grid_centroid, <span class="at">idp =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## [inverse distance weighted interpolation]</code></pre>
<div class="sourceCode" id="cb310"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb310-1"><a href="interpolation.html#cb310-1" tabindex="-1"></a>saxony_grid<span class="sc">$</span>EC_idw_1 <span class="ot">&lt;-</span> idw1<span class="sc">$</span>var1.pred</span>
<span id="cb310-2"><a href="interpolation.html#cb310-2" tabindex="-1"></a>saxony_grid<span class="sc">$</span>EC_idw_2 <span class="ot">&lt;-</span> idw2<span class="sc">$</span>var1.pred</span></code></pre></div>
<div class="sourceCode" id="cb311"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb311-1"><a href="interpolation.html#cb311-1" tabindex="-1"></a><span class="fu">tm_shape</span>(saxony_grid) <span class="sc">+</span> <span class="fu">tm_fill</span>(<span class="st">&quot;EC_idw_1&quot;</span>) <span class="sc">+</span> <span class="fu">tm_shape</span>(lucas) <span class="sc">+</span> <span class="fu">tm_dots</span>(<span class="at">col =</span> <span class="st">&quot;EC&quot;</span>, <span class="at">size =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-192-1.png" width="672" /></p>
<p><br/></p>
<div class="sourceCode" id="cb312"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb312-1"><a href="interpolation.html#cb312-1" tabindex="-1"></a><span class="fu">tm_shape</span>(saxony_grid) <span class="sc">+</span> <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">&quot;EC_idw_2&quot;</span>) <span class="sc">+</span> <span class="fu">tm_shape</span>(lucas) <span class="sc">+</span> <span class="fu">tm_dots</span>(<span class="at">col =</span> <span class="st">&quot;EC&quot;</span>, <span class="at">size =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-193-1.png" width="672" />
<br/></p>
<div class="blackbox">
<div class="center">
<p><strong>Exercise</strong></p>
</div>
<p>Try different values for the distance weighting parameter when predicting phosphorus concentrations.</p>
</div>
<p><br/></p>
</div>
<div id="kriging" class="section level2 hasAnchor" number="4.6">
<h2><span class="header-section-number">4.6</span> Kriging<a href="interpolation.html#kriging" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>While IDW provides a straightforward way to consider distance in our predictions, it has some limitations. It doesn’t account for the spatial patterns in our data - it just assumes that closer points are always more important. Kriging takes a more sophisticated approach: instead of using fixed distance-based weights, it learns the spatial structure of our data from the variogram and uses this information to determine optimal weights. Let’s see how this works!</p>
<p>First, we’ll calculate the empirical variogram, which helps us understand how variance in our data relate to distance. While gstat is getting better at working with modern sf objects, it works most reliably with the older sp format. Don’t worry though - converting between these formats is super easy and takes just one function!</p>
<div class="sourceCode" id="cb313"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb313-1"><a href="interpolation.html#cb313-1" tabindex="-1"></a>lucas_sp <span class="ot">&lt;-</span> <span class="fu">as</span>(lucas, <span class="st">&quot;Spatial&quot;</span>)</span></code></pre></div>
<p>Now we can plot a variogram cloud and fit the empirical variogram with the <code>variogram()</code> function.</p>
<div class="sourceCode" id="cb314"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb314-1"><a href="interpolation.html#cb314-1" tabindex="-1"></a>v_emp_cloud <span class="ot">&lt;-</span> <span class="fu">variogram</span>(EC<span class="sc">~</span><span class="dv">1</span>, lucas_sp, <span class="at">cloud =</span> T)</span>
<span id="cb314-2"><a href="interpolation.html#cb314-2" tabindex="-1"></a>v_emp       <span class="ot">&lt;-</span> <span class="fu">variogram</span>(EC<span class="sc">~</span><span class="dv">1</span>, lucas_sp)</span></code></pre></div>
<p>As with the <code>idw()</code> function, we don’t assume that there is a spatial trend and construct a variogram for a constant mean value.</p>
<div class="sourceCode" id="cb315"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb315-1"><a href="interpolation.html#cb315-1" tabindex="-1"></a><span class="fu">plot</span>(v_emp_cloud)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-196-1.png" width="672" /></p>
<div class="sourceCode" id="cb316"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb316-1"><a href="interpolation.html#cb316-1" tabindex="-1"></a><span class="fu">plot</span>(v_emp)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-196-2.png" width="672" />
<br/></p>
<p>To find the best variogram model we can either fit a selection of models manually …</p>
<div class="sourceCode" id="cb317"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb317-1"><a href="interpolation.html#cb317-1" tabindex="-1"></a><span class="co"># spherical</span></span>
<span id="cb317-2"><a href="interpolation.html#cb317-2" tabindex="-1"></a>v_mod_sph <span class="ot">&lt;-</span> <span class="fu">fit.variogram</span>(</span>
<span id="cb317-3"><a href="interpolation.html#cb317-3" tabindex="-1"></a>        <span class="at">object =</span> v_emp, </span>
<span id="cb317-4"><a href="interpolation.html#cb317-4" tabindex="-1"></a>        <span class="at">model  =</span> <span class="fu">vgm</span>(<span class="st">&quot;Sph&quot;</span>)</span>
<span id="cb317-5"><a href="interpolation.html#cb317-5" tabindex="-1"></a>)</span>
<span id="cb317-6"><a href="interpolation.html#cb317-6" tabindex="-1"></a><span class="co"># exponential</span></span>
<span id="cb317-7"><a href="interpolation.html#cb317-7" tabindex="-1"></a>v_mod_exp <span class="ot">&lt;-</span> <span class="fu">fit.variogram</span>(</span>
<span id="cb317-8"><a href="interpolation.html#cb317-8" tabindex="-1"></a>        <span class="at">object =</span> v_emp, </span>
<span id="cb317-9"><a href="interpolation.html#cb317-9" tabindex="-1"></a>        <span class="at">model  =</span> <span class="fu">vgm</span>(<span class="st">&quot;Exp&quot;</span>)</span>
<span id="cb317-10"><a href="interpolation.html#cb317-10" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb318"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb318-1"><a href="interpolation.html#cb318-1" tabindex="-1"></a><span class="fu">plot</span>(v_emp, v_mod_sph)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-198-1.png" width="672" /></p>
<div class="sourceCode" id="cb319"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb319-1"><a href="interpolation.html#cb319-1" tabindex="-1"></a><span class="fu">plot</span>(v_emp, v_mod_exp)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-198-2.png" width="672" />
<br/></p>
<p>… or we use the <code>automap</code> package to automatically fit and compare multiple models.</p>
<div class="sourceCode" id="cb320"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb320-1"><a href="interpolation.html#cb320-1" tabindex="-1"></a>autovar <span class="ot">&lt;-</span> <span class="fu">autofitVariogram</span>(</span>
<span id="cb320-2"><a href="interpolation.html#cb320-2" tabindex="-1"></a>        <span class="at">formula =</span> EC <span class="sc">~</span> <span class="dv">1</span>, </span>
<span id="cb320-3"><a href="interpolation.html#cb320-3" tabindex="-1"></a>        <span class="at">input_data =</span> lucas_sp</span>
<span id="cb320-4"><a href="interpolation.html#cb320-4" tabindex="-1"></a>        )</span></code></pre></div>
<p>With this variogram, we can use kriging to interpolate the EC values.</p>
<div class="sourceCode" id="cb321"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb321-1"><a href="interpolation.html#cb321-1" tabindex="-1"></a>kriging  <span class="ot">&lt;-</span> <span class="fu">krige</span>(</span>
<span id="cb321-2"><a href="interpolation.html#cb321-2" tabindex="-1"></a>        <span class="at">formula =</span> EC <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb321-3"><a href="interpolation.html#cb321-3" tabindex="-1"></a>        <span class="at">locations =</span> lucas_sp,</span>
<span id="cb321-4"><a href="interpolation.html#cb321-4" tabindex="-1"></a>        <span class="at">newdata =</span> saxony_grid_centroid,</span>
<span id="cb321-5"><a href="interpolation.html#cb321-5" tabindex="-1"></a>        <span class="at">model =</span> autovar<span class="sc">$</span>var_model</span>
<span id="cb321-6"><a href="interpolation.html#cb321-6" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## [using ordinary kriging]</code></pre>
<div class="sourceCode" id="cb323"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb323-1"><a href="interpolation.html#cb323-1" tabindex="-1"></a>saxony_grid<span class="sc">$</span>EC_krige          <span class="ot">&lt;-</span> kriging<span class="sc">$</span>var1.pred</span>
<span id="cb323-2"><a href="interpolation.html#cb323-2" tabindex="-1"></a>saxony_grid<span class="sc">$</span>EC_krige_variance <span class="ot">&lt;-</span> kriging<span class="sc">$</span>var1.var</span>
<span id="cb323-3"><a href="interpolation.html#cb323-3" tabindex="-1"></a></span>
<span id="cb323-4"><a href="interpolation.html#cb323-4" tabindex="-1"></a><span class="fu">tm_shape</span>(saxony_grid) <span class="sc">+</span> <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">&quot;EC_krige&quot;</span>) <span class="sc">+</span></span>
<span id="cb323-5"><a href="interpolation.html#cb323-5" tabindex="-1"></a>        <span class="fu">tm_shape</span>(lucas) <span class="sc">+</span> <span class="fu">tm_dots</span>(<span class="at">col =</span> <span class="st">&quot;EC&quot;</span>, <span class="at">size =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-200-1.png" width="672" />
<br/></p>
<p>Lastly, we can look at the kriging variance wish shows our uncertainty for the predicted values.
The further we are removed from measured points we larger the uncertainty.</p>
<div class="sourceCode" id="cb324"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb324-1"><a href="interpolation.html#cb324-1" tabindex="-1"></a><span class="fu">tm_shape</span>(saxony_grid) <span class="sc">+</span> <span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">&quot;EC_krige_variance&quot;</span>) <span class="sc">+</span> </span>
<span id="cb324-2"><a href="interpolation.html#cb324-2" tabindex="-1"></a>        <span class="fu">tm_shape</span>(lucas) <span class="sc">+</span> <span class="fu">tm_dots</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-201-1.png" width="672" />
<br/></p>
<div class="blackbox">
<div class="center">
<p><strong>Exercise</strong></p>
</div>
<p>Use the <code>autofitVariogram()</code> function to fit a Kirging model to the phosphorus data.</p>
</div>

</div>
</div>
<h3> References<a href="references.html#references" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-DouglasNychka2021" class="csl-entry">
Douglas Nychka, Reinhard Furrer, John Paige, and Stephan Sain. 2021. <span>“Fields: Tools for Spatial Data.”</span> Boulder, CO, USA: University Corporation for Atmospheric Research. <a href="https://github.com/dnychka/fieldsRPackage">https://github.com/dnychka/fieldsRPackage</a>.
</div>
<div id="ref-Graeler2016" class="csl-entry">
Gräler, Benedikt, Edzer Pebesma, and Gerard Heuvelink. 2016. <span>“Spatio-Temporal Interpolation Using Gstat.”</span> <em>The R Journal</em> 8: 204–18. <a href="https://journal.r-project.org/archive/2016/RJ-2016-014/index.html">https://journal.r-project.org/archive/2016/RJ-2016-014/index.html</a>.
</div>
<div id="ref-Hiemstra2008" class="csl-entry">
Hiemstra, P. H., E. J. Pebesma, C. J. W. Twenh"ofel, and G. B. M. Heuvelink. 2008. <span>“Real-Time Automatic Interpolation of Ambient Gamma Dose Rates from the Dutch Radioactivity Monitoring Network.”</span> <em>Computers &amp; Geosciences</em>.
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="point-pattern-analysis.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="machine-learning.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/USERNAME/REPO/edit/BRANCH/04_interpolation.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
