---
title: 'Species Distribution Modeling with HMSC '
author: 'Jonathan Jupke '
date: '2020-10-26'
slug: species-distribution-modeling-with-hmsc
categories: []
tags:
  - R
  - HMSC
  - MOD3
comments: no
images: ~
---

<link href="index_files/anchor-sections/anchor-sections.css" rel="stylesheet" />
<script src="index_files/anchor-sections/anchor-sections.js"></script>


<pre class="r"><code>#TODO where did I get the Data from? 
#TODO add link to multispecies example</code></pre>
<p>Intro text</p>
<p>To run this code you will need to install the pacman R package beforehand but this will take care of all the other packages required.</p>
<pre class="r"><code>pacman::p_load(abind, data.table, ggplot2, here, Hmsc, magrittr)</code></pre>
<p>We use the Finnish bird data that are also often used by the creators of HMSC to demonstrate the package (e.g.Â here and here). In this example we will focus on a single species, the Western Jackdaw (<em>Corvus monedula</em>). You can find an example with a joint species distribution model, that makes use of all features of HMSC, here.
We also look at just one year (2014) while the data set contains the year 2006 to 2014.</p>
<pre class="r"><code>data = fread(file.path(data.directory, &quot;data.csv&quot;))
data = data[Year == 2014]
data %&lt;&gt;% droplevels()

XData = as.data.frame(data[, c(&quot;Habitat&quot;, &quot;AprMay&quot;)])
names(XData) = c(&quot;hab&quot;, &quot;clim&quot;)

Y = as.matrix(data$Corvus_monedula)
colnames(Y) = &quot;Corvus monedula&quot;

xy = as.matrix(data[, c(&quot;x&quot;, &quot;y&quot;)])
studyDesign = data.frame(route = factor(data$Route))
rownames(xy) = studyDesign[, 1]
rL = HmscRandomLevel(sData = xy)

XFormula =  ~ hab + poly(clim, degree = 2, raw = TRUE)</code></pre>
<p>Fit the model</p>
<pre class="r"><code>m_full = Hmsc(Y=Y,
              XData=XData,
              XFormula=XFormula,
              distr = &quot;lognormal poisson&quot;,
              studyDesign = studyDesign,
              ranLevels=list(route=rL))</code></pre>
<p>Run MCMC</p>
<pre class="r"><code>nChains = 2
thin = c(5, 10, 100)
nParallel = max(round(parallel::detectCores() / 2), nChains)
samples = 1000
transient = 500 * thin
verbose = 500 * thin

# for (i in seq_along(thin)) {
#         model[[i]] = sampleMcmc(
#                 m_full,
#                 thin = thin[i],
#                 samples = samples,
#                 transient = transient,
#                 nChains = nChains,
#                 verbose = verbose,
#                 initPar = &quot;fixed effects&quot;
#                 
#         )
# }</code></pre>
